{
  "ncc-1604_moss_phpmyadmin-006": "vulnerability csv export allows arbitrary command execution in csv file risk medium impact: medium,exploitability: high identifier ncc-1604_moss_phpmyadmin-006 category data validation location the csv export functionality 3 impact a malicious user can change a database field so that when an administrator uses the export functionality and opens the exported csv in a spreadsheet editor such as excel,code may be run on the administrator's computer. alternatively, a malicious or compromised administrator can add or modify users with formulas in various fields to target other application administrators and users. description the csv export functionality does not properly escape exported csv field values. this can lead to code execution on a user's computer. this is done by including a formula in the csv file that a spreadsheet editor similar to excel will evaluate - the formula can include commands to be run on the user's computer. for example, if a user changes a database name or column value to be=cmd|' /c calc'!a0 and the database is then exported in csv format by another user, calc.exe will run when the file is evaluated by a spreadsheet editor. the victim user will be prompted with a warning, but since the user has downloaded the csv from a trusted source, they are likely to allow the functionality. it should be noted that encapsulating the values with quotation marks (\") does not mitigate the issue. reproduction steps 1. log into phpmyadmin and insert =cmd|' /c calc'!a0 into a database column value. 2. export the database in csv format. 3. open the exported csv file that was exported in windows excel and click through the warnings. 4. observe the calculator application now running on the computer. recommendation when performing a csv export, for any cell that starts with an =,-,\",@,or +,add a space to the beginning and remove any tab characters (0x09) in the cell. alternatively, prepend each cell field with a single quote, so that their content will be read as text by the spreadsheet editor. 3 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/plugins/export/exportcsv.php 6 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-007": "vulnerability login/logout actions vulnerable to csrf risk medium impact: medium,exploitability: high identifier ncc-1604_moss_phpmyadmin-007 category data validation location the phpmyadmin login and logout  functionality impact an attacker could cause a user to logout of phpmyadmin. alternatively, a malicious user could cause a phpmyadmin administrator to authenticate to phpmyadmin using their account. description cross-site request forgery(csrf)countermeasures used in the application are not validated for the login or logout phpmyadmin functionalities. in a csrf attack, a user is forced to perform state-changing actions without the knowledge, while authenticated to an application. the current csrf countermeasures require that all state-changing requests include a token. the lack of validation of this value for both the login and logout functionalities leaves users vulnerable to this type of attack. as a result,an attacker could cause a user to authenticate using another account or end their current session. reproduction steps 1. authenticate to phpmyadmin. 2. save the following as csrf.html, open it in the same browser. be sure to modify the old_usr value to the authenticated user's name and the domain to reflect your environment if not using a local deployment. <html> <body> <img src=\"http://localhost /phpmyadmin /index.php?db=&token=8 ec5d8124049db01413c49351d0acf44 &old_usr=[authenticated user]\" /> </body> </html> 3. observe the user's ended session. recommendation to ensure that state changing requests are from an authorized user, validate the included token value. in addition, to ensure that sensitive data is not leaked via get url query parameters perform all state changing requests as post requests and submitting data via request body(see finding ncc-1604_moss_phpmyadmin-001 on page 10 for further details). 4 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/common.inc.php#l402-l403 5 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/common.inc.php#l407-l408 7 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-009": "vulnerability ability to unset arbitrary server global variables risk medium impact: undetermined,exploitability: medium identifier ncc-1604_moss_phpmyadmin-009 category data validation location the pma_removerequestvars() function in cleanup.lib.php 6 impact an attacker can forge requests that will remove (unset) specific global variables on the service side. this can be used for a targeted denial of service (dos) and potentially other attacks. note: because of the large amount of global variables, and the relatively short nature of this assessment, nccgroup was unable to fully determine the impact of this vulnerability. description all php files include libraries/common.inc.php, which in turn includes libraries/cleanup.lib.php for sanitizing user input if the cross-site request forgery token is missing. the function pma_removerequestvars() iterates over the user input in get and post variables, as well as cookies, and then removes the variables not whitelisted. this function however, appears to be calling unset()on$global[$key]instead of $_cookie[$key], effectively removing global variables. an attacker can forge malicious urls and leverage the cleanup function to remove internal variables. for instance, the$global['cfg'] array, containing the configuration of the application could be targeted. by supplying a parameter name dcfg in the request, the phpmyadmin application will be completely inaccessible (local dos). reproduction steps login to phpmyadmin then access the following url:/phpmyadmin/index.php?cfg=foo. notice how the displayed page is completely blank. recommendation fix the pma_removerequestvars() function to correctly sanitize the $_cookiearray instead of the $globalarray. 6https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/cleanup.lib.php#l28 8 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-005": "vulnerability sensitive values vulnerable to session fixation risk low impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-005 category session management location the cross-site request forgery (csrf)protection token and the phpmyadmin cookie impact an attacker can perform various targeted attacks, such as csrf, against a victim user or administrator. description session fixation is a type of session hijacking attack that can occur when a user is not assigned a new session identifier post-authentication. when a user first visits the phpmyadmin login page,the server sets the token csrf protection value and phpmyadmin cookie. when the user authenticates, these values are not reset. if an attacker knows the value of the user's token before the user has logged in, the attacker will be able to perform other targeted attacks, such as cross-site scripting(see finding ncc-1604_moss_phpmyadmin-008 on page 13 )or csrf,against the user. currently all state-changing and other sensitive actions require additional cookies to successfully execute requests. consequently, the risk associated with the phpmyadmin cookie session fixation vulnerability is informational-however,if this were to change in future,any action relying on this cookie for validation would be vulnerable to attack. reproduction steps 1. proxy browser traffic using a proxy similar to burp proxy. 8 2. visit the phpmyadmin login page, and make note of the phpmyadmin cookie and csrf token values included in the response. 3. authenticate to phpmyadmin. 4. observe the lack of change for the phpmyadmin cookie and csrf token values. recommendation when users authenticate, change rights levels, or identity, they should immediately be assigned a new session cookie. this can be done by invalidating the old session id and issuing a new one. in addition, csrf tokens should be reset with each new user session post- authentication. 7 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/session.inc.php 8 https://portswigger.net/burp/download.html 9 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-001": "vulnerability sensitive data in url get query parameters risk low impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-001 category data exposure location the following parameters: token,sql_query,old_usr impact sensitive data may be intercepted by an attacker with the ability to read application traffic or logs. the attacker may then be able to perform chosen actions via the user's account, unbeknownst to the user. description several parameters containing sensitive values are transmitted in url get query parameters. these parameters include the token parameter, used to mitigate cross-site request forgery attacks, sql_query, which contains sql queries that have been run from phpmyadmin, and old_usr, which exposes the previously authenticated account username. it should be noted that while plaintext password values are masked for the sql_query parameter, password hashes are not. sending sensitive information via url get query parameters unnecessarily exposes these values in logs, caches, and referer headers to third parties. get / http/1.1 host: codemirror .net ---redacted --- referer : http://localhost /phpmyadmin /setup/index.php? token=99b4e72f96146d5904c6f6d00539d711&page=form&formset =sql_queries connection : close referer header token leaks are only possible via links from the changelog( /phpmyadmin/ changelog.php) or phpmyadmin setup site ( /phpmyadmin/setup/index.php).neither of these pages make use of url.php, 9 which would effectively prevent this leakage. while compromise of the token parameter can be damaging for a phpmyadminuser, it is not likely that a third party would abuse the value. it does, however, expand phpmyadmin's attack surface and puts users at risk in the event of an attack on any of the various third party systems or network traffic. reproduction steps 1. proxy browser traffic using a proxy similar to burp proxy. 2. authenticate to phpmyadmin. 3. observe the token as a get query parameter in the proxy history. recommendation submit the above parameters using post requests, instead of get requests. the parameters should be passed in the post request body and not as url query parameters. update all links from the change log and phpmyadmin setup site to use url.php 10 to ensure that data is not unnecessarily exposed to third-party sites. do not enable $cfg['logincookierecall'] by default. 11 this is a defense-in-depth solution to ensure that phpmyadm in usernames are not leaked via the old_usr parameterp ost logout. 9 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 10 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 11 https://docs.phpmyadmin.net/en/latest/config.html#cfg_logincookierecall 10 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-002": "vulnerability overly permissive content security policy risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-002 category authentication location the content security policy defined in libraries/header.php 12 impact if an application endpoint displays any user input from the url in the contents of the page, an attacker could craft a link with a malicious javascript payload and create a reflected cross-site scripting (xss) vulnerability. phpmyadmin is vulnerable, as reflected xss payloads are being served from page contents inside the origin's domain (which is allowed to run inline javascript). description content security policy13 is a security feature that allows web sites to specify settings for modern browsers to enforce protections on web content. in the case of phpmyadmin,the following content-security-policy header allows inline elements such as <script>and <style> to be included in all pages as long as they are loaded in the context of the same origin. content-security-policy : default -src 'self' ;script -src 'self' 'unsafe-inline' 'unsafe-eval' ;;style-src 'self' 'unsafe-inline' ;img-src 'self' data: *. tile.openstreetmap .org; listing1: content-security-policy header while the intention of the policy may have been to restrict loading of script resources to those that originated from the domain, this policy will provide no protection against most types of xss attacks, as malicious <script> injections can still originate from the trusted domain. reproduction steps 1. proxy browser traffic using a proxy similar to burp proxy. 2. access/phpmyadmin/index.php. 3. observe the headers returned by the server, in particular, the ``content-security-policy'' header. recommendation tighten the content security policy as much as possible. disable `unsafe-eval'and`unsafe-inline' if its use cannot be justified. when adding functionality to the site in the future, keep the scope for allowed scripts, styles, and javascript callbacks as small as possible. remember that content security policy is not a replacement for xss protection. for more information on the various content security policy directives,see the mozilla developer network. 14 12 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/header.php#l541-l558 13 https://www.nccgroup.trust/globalassets/our-research/us/whitepapers/csp_best_practices.pdf 14 https://developer.mozilla.org/en-us/docs/security/csp/csp_policy_directives 11 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-004": "vulnerability file traversal protection bypass on error reporting risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-004 category data exposure location the error reporting endpoint,available at error_report.php 15 impact it is possible to confirm the presence of system files on the remote host as well as obtain their line count. description the pma_countlines() function available online 229 of error_report.lib.php 16 contains logic to prevent malicious user input from opening files outside the javascript directory. however, it is possible to bypass the protections and access files anywhere on the system. the function attempts to track the file depth of the path by splitting the path in to parts between the slash ``/'' delimiters. the function decrements the depth on parent ``/../'' parts, correctly skips dot``/./''parts(no depth change) and increments the depth on every thing else. if at any time the depth becomes negative(meaning that the user reached a directory before the intended root javascript directory),the function returns. this logic can be bypassed by sending a path containing empty parts``//'', which will increment the tracked depth but remain in the actual folder, allowing an attacker to then use the parent ``/../'' while still keeping a positive depth. as the pma_countlines() function only reports the size of the target files and not their contents, the significance of this vulnerability is greatly reduced. furthermore,to exploit this finding, the senderrorreports configuration setting must be set to ask or always. reproduction steps 1. configure phpmyadmin to report errors by setting the following line in /etc/phpmyadmin/config.inc.php: $cfg['servers '][$i]['senderrorreports '] = 'always '; 2. proxy browser traffic using a proxy similar to burp proxy. 3. trigger an error in the javascript front-end by inserting an incorrect variable or function name in the javascript files. 4. intercept the post request to /phpmyadmin/error_report.php and modify the following section: exception [stack][12][ url]=http://localhost /phpmyadmin /js/get_scripts . js.php?scripts []=////////../../../../../../etc/passwd 5. observe the returned line count. recommendation use php's realpathfunction 17 to verify that the target javascript directory is in the path. if this is not possible, process empty parts``//''of the path the same way the dot``/./''path are processed: do not increment the depth. alternatively, consider rejecting altogether paths containing the parent``/../''directory. 15 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/error_report.php 16https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/error_report.lib.php#l229-l260 17https://secure.php.net/manual/en/function.realpath.php 12 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-008": "vulnerability self xss in table_row_action.php risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-008 category data validation location the pma_getqueryfromselected() functionin libraries/mult_submits.lib.php 18 impact with knowledge of the csrf token it is possible to trigger a cross-site scripting vulnerability. description the pma_getqueryfromselected() function inside mult_submits.lib.php 19 takes user input and sanitizes it before displaying it back inside the page. however,the function calls urldecode() after htmlspecialchars(),20 allowing for special html characters to be passed as urlencoded values and displayed back as special characters in the page. $full_query .= 'delete from ' . pma\\libraries \\util::backquote (htmlspecialchars ($table)) . ' where ' . urldecode(htmlspecialchars($sval)) . ';<br />'; this vulnerable code is executed when browsing the data of a table, then selecting multiple rows and marking them for deletion. phpmyadmin will prepare the delete sql statement it is about to execute and display it to the user for confirmation before executing it. an attacker who is able to gain access to the csrf token value,such as by exploiting find- ingncc-1604_moss_phpmyadmin-005 on page 9 ,will then be able to exploit this vulnerability and inject javascript code into the victim's session. reproduction steps 1. proxy browser traffic using a proxy similar to burp proxy. 2. navigate to the``browse''section of a table inside a database. 3. select some rows then click on``delete''. 4. modify the post request to /phpmyadmin/tbl_row_action.php with the following body: db=foo&table=bar&token=[token]&goto=sql.php&rows_to_delete %5b0%5d=%2560 bar%2560.%2560 a%2560%2 b%253d%2b3%25%33%31%25%33%63%25%34%39%25%34%64%25 %34%37%25%32%30%25%35%33%25%35%32%25%34%33%25%33%64%25%32%37%25%36%31%2 5%32%37%25%32%30%25%36%66%25%36%65%25%36%35%25%37%32%25%37%32%25%36%66% 25%37%32%25%33%64%25%32%37%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34 %25%32%38%25%33%31%25%32%39%25%32%37%25%33%65& sql_query=select +*+from+% 60bar%60&clause _is_unique =1&ajax_request =true&ajax_page_request =true&su bmit_mult=delete &_nocache =1462283900030800007 a listing2: urlencoded payload of``<imgsrc='a'onerror='alert(1)'>'' 5. notice how the javascript payload is executed by the browser. recommendation call htmlspecialchars() after calling any type of decoding on user input, in this case, swap the calls to have: . ' where ' . htmlspecialchars(urldecode($sval)) 18 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l477 19 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l477 20 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l498 13 | phpmyadmin phpmyadmin/nccgroupconfidential",
  "ncc-1604_moss_phpmyadmin-003": "vulnerability multiple http plaintext links risk informational impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-003 category data exposure location linked pages in the following: * index.php21 * changelog.php22 * libraries/config/messages.inc.php23 * libraries/util.php24 impact requests for the various content linked from phpmyadmin and the associated setup site may be intercepted by an attacker and modified to include malicious content. alternatively, an attacker could use this vector to perform an sslstripping attack against the user. description multiple pages linked from the phpmyadmin are hardcoded to make use of plaintext http connections. an attacker in a privileged network position could arbitrarily modify the returned content in order to perform a variety of attacks such as sslstripping, cross-site scripting, phishing, etc. in addition, pages linked from the changelog (/phpmyadmin/changelog.php) and the phpmyadmins etup site( /phpmyadmin/setup/index.php) donotmakeuseofurl.php. 25 asa result, links from either the change log or setup site will leak the token to third parties via the referer header(see finding ncc-1604_moss_phpmyadmin-001 on page 10 ). reproduction steps 1. authenticate to phpmyadmin. 2. navigate to the``official homepage''link under the``phpmyadmin''section of homepage. 3. observe the resulting request via plain text http. recommendation update all links to use https exclusively. it should be noted that each of the cited linked pages support https versions, which should make securing links relatively painless. enforcing all links to employ https will significantly reduce the unnecessary risk placed on users when switching between https and http connections, and will help mitigate data exposure and man-in-the-middle attacks. enable http strict transport security (hsts) 26 to prevent users from accidentally visiting the site over unsecured http and exposing themselves to the risk of an sslstripping attack. 27 note that the hsts is ignored by browsers when sent over http. it must be sent over https connections. 21 https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/index.php 22https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/changelog.php 23https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/config/messages.inc.php 24https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/util.php 25https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 26https://www.owasp.org/index.php/http_strict_transport_security 27https://moxie.org/software/sslstrip/ 14 | phpmyadmin phpmyadmin/nccgroupconfidential"
}