report for: aws security assessment sample report clientname march 24, 2021  executive summary this report presents the findings of the aws configuration security assessment conducted on behalf of client com- pany ltd (clientname). the assessment was conducted between 15/03/2021 and 19/03/2021 and was authorised by clientname. 1.1 overview the systems within scope require further work to ensure the security posture is appropriate to the assets which require protection. two high risk issues were identified; these and other issues set out in this report should be addressed so that the organisation's security model maintains an appropriate defence in depth basis. the following table breaks down the issues which were identified by component and severity of risk (issues which are reported for information only are not included in the totals): component critical high medium low total phase 2-aws review 0 2 3 5 10 total 0 2 3 5 10 1.2 assessment summary the most significant issue identified in the aws configuration review was that iam roles were assigned with exces- sive permissions. as a result, it was possible for a number of users to perform actions, such as executing arbitrary commands and accessing sensitive objects, for which they should not have sufficient permissions. it was also of note that the network configuration was overly permissive. the account was configured in such a way that it was accessible from external addresses and the account had a high level of database connectivity. consequently, it may be possible for external users to view the database and extract sensitive information, or information that may be helpful in developing further attacks. it is recommended that clientname's resources are made only as accessible as necessary for normal business operation, in line with the principle of least privilege. the remaining issues were all assessed to pose a lower risk or are reported for information only. nevertheless, it is recommended that these are reviewed and addressed so as to bring the environment within scope into line with security best practice. it is important to recognise that even low risk issues can be exploited in combination with other issues as part of a wider attack which seeks to compromise an environment or application. in addition, resolving lower risk issues can have the dual benefit of reducing the attractiveness of systems to opportunistic attackers as well as enhancing the overall security posture. more detailed information on each of the issues which were identified is included in the technical details section of this report. 1.3 strategic recommendations the permissions assigned to the various iam roles should be reviewed and amended such that all roles are only ac- corded the minimum permissions required to perform the required business functions. the inbuilt aws iam tools and functionality allow a considerable degree of control; however, these controls can only be effective when permissions are assigned to roles in accordance with the principle of least privilege. similarly, the aws account should not be externally accessible from the wider internet and the principle of least privilege should be applied to the resources which are accessible within the account. alternatively, if external access is required, consideration should be given to restricting access to trusted ip addresses only. version 1.0- page 2 of 23 it is acknowledged that operational business requirements may mean that a risk has to be accepted (or partly accepted) rather than mitigated. where this is the case, it is recommended that this is appropriately documented within the relevant risk register to ensure that the organisation maintains full visibility of the risk to which it is exposed. it is recommended that the issues set out in this report should be addressed by a structured programme of remedial actions which are prioritised in accordance with the perceived risk to the organisation. version 1.0- page 3 of 23 2 table of contents 1 executive summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.1 overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.2 assessment summary . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1.3 strategic recommendations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 2 table of contents. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 3 technical summary. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 3.1 scope . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 3.2 caveats . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 3.3 post assessment cleanup. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 3.4 risk ratings . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 3.5 findings overview . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 4 technical details. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 5 document control. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 5.1 document data . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 5.2 document history . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 5.3 document distribution list . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22 6 assessment team . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23 version 1.0- page 4 of 23 3 technical summary test organization was contracted by clientname to conduct a security assessment of the systems within scope in order to identify security issues that could negatively affect clientname's business or reputation if they led to the compromise or abuse of systems. 3.1 scope the security assessment was carried out in the production environment and included: u aws review the environment within the scope of this test is listed below: u client aws account123456789012 3.2 caveats due to the nature of the environment, checks that would have a high probability of causing disruption to the named hosts were excluded. denial of service attempts were excluded for the same reason. 3.3 post assessment cleanup any test accounts which were created for the purpose of this assessment should be disabled or removed, as appro- priate, together with any associated content. delete the aws account provisioned for this assessment. revert any waf/ids/ips/firewall changes which were made for the purposes of the assessment. version 1.0- page 5 of 23 3.4 risk ratings the table below gives a key to the icons and symbols used throughout this report to provide a clear and concise risk scoring system. it should be stressed that quantifying the overall business risk posed by any of the issues found in any test is outside our remit. this means that some risks may be reported as high from a technical perspective but may, as a result of other controls unknown to us, be considered acceptable. symbol risk rating cvssv2 score explanation critical 9.0 - 10 a vulnerability was discovered that has been rated as critical. this requires resolution as quickly as possible. high 7.0 - 8.9 a vulnerability was discovered that has been rated as high. this requires resolution in the short term. medium 4.0 - 6.9 a vulnerability was discovered that has been rated as medium. this should be resolved as part of the ongoing security maintenance of the system. low 1.0 - 3.9 a vulnerability was discovered that has been rated as low. this should be addressed as part of routine maintenance tasks. info 0 - 0.9 a discovery was made that is reported for information. this should be addressed in order to meet leading practice. good n/a good security practices were being followed or an audit item was found to be present and correct. version 1.0- page 6 of 23 3.5 findings overview all the issues identified during the assessment are listed below with a risk rating for each issue. ref finding risk sr-109-001 iam roles assigned with excessive permissions high sr-109-002 overly permissive network configuration high sr-109-003 unauthorised access to s3 buckets medium sr-109-004 user without mfa enabled medium sr-109-005 iam password policy medium sr-109-006 automated backups not enabled for rds instances low sr-109-007 single availability zone rds instance low sr-109-008 unused security groups low sr-109-009 subnets using default network acls low sr-109-010 cloudformation stack without termination protection low version 1.0- page 7 of 23 4 technical details sr-109-001 iam roles assigned with excessive permissions risk rating high status open description: an analysis of the configured roles that were then assigned to running ec2 instances indicated that some of them would receive excessive permissions that could allow arbitrary commands to be launched across all the instances, read arbitrary s3 objects, etc. as an example, the following role was present in the aws configuration reviewed during this assessment: [role name] the following is a screenshot for this role listing the inline policies: figure 1: sample role with inline policies attached the "iamfullaccess" inline policy was defined as follows: { "version": "2020-10-17", "statement": [ { "effect": "allow", "action": "iam:*", "resource": "*" } ] } the above policy gave administrative permissions to perform all actions in iam, including managing passwords, access keys, mfa devices and user certificates. this issue was rated as high risk in consideration of the security impact of unrestricted access to the iam service. version 1.0- page 8 of 23 recommendation: create managed security policies following the least privileges security principle (i.e. including only the minimal set of api commands necessary for operations and listing the resources that would be affected by these commands) and attach these to the roles in use.1, 2, 3, 4 affects: aws account 123456789012 1aws identity and access management (iam)https://aws.amazon.com/iam/ 2aws identity and access management documentationhttps://aws.amazon.com/documentation/iam/ 3aws documentation-iam best practices: use aws defined policies to assign permissions whenever possiblehttps://docs.aws.amazon.com/ iam/latest/userguide/best-practices.html#bp-use-aws-defined-policies 4aws documentation -iam best practices: grant least privilege https://docs.aws.amazon.com/iam/latest/userguide/best- practices.html#grant-least-privilege version 1.0- page 9 of 23 sr-109-002 overly permissive network configuration risk rating high status open description: examination of the high level architecture diagram and configured firewall rules indicated that the network configura- tion was excessively permissive and a number of resources were publicly available. the following high level figure illustrates the external addresses that were allowed a degree of access into the account: figure 2: global view of the aws account the following figure illustrates the high level database connectivity within the account: figure 3: high level view of the database connectivity version 1.0- page 10 of 23 the following figure illustrates the high level configuration of virtual private networks (vpcs) within the account: figure 4: high level view of the vpc configuration after review of the above, the following observations can be made: u a large number of resources were publicly accessible. this presents an opportunity for abuse, especially in the case of sensitive or corporate resources. u a permissive network configuration was observed, which allowed connections between resources in different sub- lets and vpcs. this poses a significant risk in the event that a host is compromised, as it would potentially enable attackers to move laterally within the aws account. u the aws account held all of clientname's assets, including corporate and production environments. this is consid- ered contrary to security best practice. recommendation: unless necessary for normal business operation, ensure that the network is only accessible from internal addresses, or if not possible, consider creating a whitelist of external addresses which can access the network. doing so will limit the resources that are accessible to an attacker. this could deny the individual access to information that may have been helpful in developing an attack, and it may deny a potential avenue into a achieving a foothold on the network. clientname should also limit the access privileges and general interconnectivity of the sublets, vpcs, and aws account in line with the principle of least privilege. these privileges should be reduced to only what is necessary for normal operation of the business to as to limit an attacker's options in the event of a compromise. affects: aws account 123456789012 version 1.0- page 11 of 23 sr-109-003 unauthorised access to s3 buckets risk rating medium status open description: an s3 bucket was found to be configured with excessive permissions that could allow unauthorised access to the stored objects. this bucket included access to logs of the portal web application. the following screenshot from the management console shows how full permissions to access the objects stored in the bucketname bucket were granted to any authenticated aws user: figure 5: s3 bucket access the "any authenticated aws user" is a special group that will include any user having access to aws and not only the users associated with the clientname account. to demonstrate this problem, the following command was executed using api keys belonging to an test organization account: $ aws --profile testorg s3 ls --recursive s3://[bucketname] ... 2021-01-25 09:45:04 765520 logs-01-25-2021.log 2021-01-26 11:22:01 801528 logs-01-26-2021.log ... according to the permissions visible above, objects could have been downloaded and also deleted or otherwise edited. additionally, new objects could be uploaded. the following table includes all the s3 buckets affected by this issue and the type of permissions allowed to anonymous and any other aws user (i.e. including aws users not belonging to clientname): s3 bucket user type list upload/delete view edit bucketname any aws user yes yes yes yes technical details about this issue were transmitted to clientname during testing and some actions were performed to mitigate the risk associated with this issue. version 1.0- page 12 of 23 recommendation: edit the permissions associated to the affected s3 buckets ensuring that no permissions are granted to the anonymous or "any authenticated aws user" group.5, 6, 7 affects: aws account 123456789012 5amazon s3https://aws.amazon.com/s3/ 6amazon simple storage service documentationhttps://aws.amazon.com/documentation/s3/ 7aws documentation-managing access permissions to your amazon s3 resourceshttps://docs.aws.amazon.com/amazons3/latest/dev/s3- access-control.html version 1.0- page 13 of 23 sr-109-004 user without mfa enabled risk rating medium status open description: multiple accounts were identified which had password authentication enabled but did not have multi-factor authenti- cation (mfa) enabled, contrary to security best practice. if mfa is not enabled, attackers could be able to access the aws web console with just a username and password combination. the following users had password-enabled access but were not configured to use multi-factor authentication: <<list of users without mfa enabled>> the users listed above were identified by running the following command from the aws cli: aws iam get-credential-report --query 'content' --output text | base64 -d | cut -d, -f1,4,8 the following was returned during testing in response to the above command: [username], true, false in this case, "true" after the username means that authentication via password was active. however, "false" returned in the third column means that mfa was not active. recommendation: implement mfa for the users with password authentication enabled.8, 9, 10, 11 affects: aws account 123456789012 8aws identity and access management (iam)https://aws.amazon.com/iam/ 9aws identity and access management documentationhttps://aws.amazon.com/documentation/iam/ 10aws documentation -using multi-factor authentication (mfa) in aws https://docs.aws.amazon.com/iam/latest/userguide/ id_credentials_mfa.html 11cis amazon web services foundationshttps://d0.awsstatic.com/whitepapers/compliance/aws_cis_foundations_benchmark.pdf version 1.0- page 14 of 23 sr-109-005 iam password policy risk rating medium status open description: no password policy was enabled in the iam settings. this could result in the creation of weak user passwords. the following screenshot illustrates the password policy settings that were observed: figure 6: password policy not enforced version 1.0- page 15 of 23 recommendation: ensure a strong password policy is in place. specifically ensure that the following password policy is enforced:12, 13, 14, 15 u passwords should use mixed case u passwords should include at least one number u passwords should include at least one symbol u passwords have a minimum length of 14 characters u passwords cannot be reused affects: aws account 123456789012 12aws identity and access management (iam)https://aws.amazon.com/iam/ 13aws identity and access management documentationhttps://aws.amazon.com/documentation/iam/ 14aws documentation-managing passwordshttps://docs.aws.amazon.com/iam/latest/userguide/credentials-managingpasswords.html 15cis amazon web services foundationshttps://www.cisecurity.org/benchmark/amazon_web_services/ version 1.0- page 16 of 23 sr-109-006 automated backups not enabled for rds instances risk rating low status open description: automated backups had not been enabled for a number of relational database service (rds) instances. this feature facilitates the creation of periodic rds instance snapshots, which in turn ensure that data restoration is possible in the event of an incident affecting the source database. the following screenshot from the management console shows that theproduction-data and development-db rds instances had automated backups disabled: figure 7: rds instance with automated backups disabled recommendation: ensure that all rds database instances that host sensitive data have automated backups enabled for point-in-time recovery. 16, 17, 18 affects: aws account 123456789012 16amazon relational database service (rds)https://aws.amazon.com/rds/ 17amazon relational database service documentationhttps://aws.amazon.com/documentation/rds/ 18aws documentation -backing up and restoring amazon rds db instanceshttps://docs.aws.amazon.com/amazonrds/latest/userguide/ chap_commontasks.backuprestore.html version 1.0- page 17 of 23 sr-109-007 single availability zone rds instance risk rating low status open description: a number of relational database service (rds) instances were configured without the multi-availability zone (multi-az) enabled. without this, should an availability zone specific database failure occur, then amazon rds cannot automat- ically fail over to the standby availability zone so that database operations can resume quickly without administrative intervention. the following database instances (based on the aurora engine) were configured with multi-az disabled: u preproduction-data u test-data u development-db the following screenshot shows that multi-az was disabled for one of the instances listed above: figure 8: rds availability zone recommendation: consideration should be given to modifying the configuration of the database instances to enable multi-az. this is especially important if the applications using the databases require high availability.19, 20, 21 affects: aws account 123456789012 19amazon relational database service (rds)https://aws.amazon.com/rds/ 20amazon relational database service documentationhttps://aws.amazon.com/documentation/rds/ 21aws documentation-high availability (multi-az)https://docs.aws.amazon.com/amazonrds/latest/userguide/concepts.multiaz.html version 1.0- page 18 of 23 sr-109-008 unused security groups risk rating low status open description: a number of security groups were defined which were unused and may not be required. this being the case, their existence in the configuration increases the risk that they may be inappropriately assigned. the following security groups were found to be unused: u securitygroupname1 (security group idsg-123456789) u securitygroupname2 (security group idsg-123456789) u securitygroupname3 (security group idsg-123456789) recommendation: the unused security groups should be reviewed and removed if no longer required.22, 23, 24 affects: aws account 123456789012 22amazon virtual private cloudhttps://aws.amazon.com/vpc/ 23amazon virtual private cloud documentationhttps://aws.amazon.com/documentation/vpc/ 24cis amazon web services foundationshttps://d0.awsstatic.com/whitepapers/compliance/aws_cis_foundations_benchmark.pdf version 1.0- page 19 of 23 sr-109-009 subnets using default network acls risk rating low status open description: a number of subnets were identified to be using the default network access control list (nacl), allowing all incoming and outgoing network traffic. in this configuration, the affected nacls do not provide the secondary layer of security defence that they are supposed to. the following network acls were affected by this issue in theus-east-1 region: u <<nacl name>> (nacl idacl-123456789) u <<nacl name>> (nacl idacl-123456789) u <<nacl name>> (nacl idacl-123456789) the following screenshot was taken from the aws management console and shows the inbound rules available for the first of the nacls listed above: figure 9: default network acl in use the outbound rules were similar, allowing all outgoing traffic. it should be noted that default nacls were also available across the remaining aws regions/vpc. recommendation: network acls should be considered as the secondary layer of security defence against unwanted traffic. consequently, consideration should be given to implementing nacls that only allow the necessary inbound and outbound traffic to the associated vpc subnets.25, 26, 27, 28, 29 affects: aws account 123456789012 25amazon virtual private cloudhttps://aws.amazon.com/vpc/ 26amazon virtual private cloud documentationhttps://aws.amazon.com/documentation/vpc/ 27aws documentation-vpc securityhttps://docs.aws.amazon.com/amazonvpc/latest/userguide/vpc_security.html 28aws documentation-network aclshttps://docs.aws.amazon.com/amazonvpc/latest/userguide/vpc_acls.html7 29aws documentation -recommended network acl rules for your vpc https://docs.aws.amazon.com/amazonvpc/latest/userguide/ vpc_appendix_nacls.html version 1.0- page 20 of 23 sr-109-010 cloudformation stack without termination protection risk rating low status open description: the termination protection setting available for the cloudformation service was not found to be enabled for one stack. when this feature is enabled for a stack, deletion attempts will fail and the stack (including its current status), will remain unchanged. security best practice for cloudformation management recommends enabling this feature for production environments. the following command was run for thestackname stack: $ aws cloudformation describe-stacks --region eu-west-1 --stack-name [stackname] -- query 'stacks[*].enableterminationprotection' [ false ] as can be seen above, thedescribe-stacks command returnedfalse, indicating that the termination protection safety feature was not enabled for the selected stack. it should be noted that cloudformation stack policies may also be used to prevent stack resources from being un- intentionally updated or deleted during a stack update process. however, stack policies cannot protect stacks from being terminated, as iam users who have the permission to delete a stack may still delete it. recommendation: ensure that amazon cloudformation stacks have termination protection enabled in order to protect them from being accidentally deleted.30, 31, 32 affects: aws account 123456789012 30aws cloudformationhttps://aws.amazon.com/cloudformation/ 31aws cloudformation documentationhttps://aws.amazon.com/documentation/cloudformation/ 32aws documentation-protecting a stack from being deletedhttps://docs.aws.amazon.com/awscloudformation/latest/userguide/using-cfn- protect-stacks.html version 1.0- page 21 of 23 5 document control ity this document contains  information and may not be copied without written permission. proprietary information the content of this document should be considered proprietary information and should not be disclosed outside of client company ltd (clientname). test organization gives permission to copy this report for the purposes of disseminating information within your organisation or any regulatory agency. 5.1 document data data classification  client name clientname project reference 99999 document title aws security assessment sample report author test organization consultant 5.2 document history issue no. issue date issued by change description 0.1 2021-03-22 test organization consultant draft for test organization internal review only 0.2 2021-03-23 a. reviewer revised qa 1.0 2021-03-24 test organization consultant released to client 5.3 document distribution list name role a. sponsor project sponsor, clientname test organization consultant consultant, test organization a. manager account manager, test organization version 1.0- page 22 of 23 6 assessment team the following members of staff were assigned to this assessment: name job title comments test organization consultant senior security consultant, test organization crest registered tester (crt), offensive security certified professional (oscp) version 1.0- page 23 of 23 