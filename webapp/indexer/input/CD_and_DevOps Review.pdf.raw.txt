report for: agile development environment security assessment client company ltd. september 2020 test org plc - security testing audit and compliance version 1.0 - page 2 of 44  executive summary this report presents the findings of the agile development environment security assessment conducted on behalf of client company ltd. (client). the assessment was conducted between 21/09/2020 and 30/09/2020 and was authorised by client. the system under assessment was an environment designed to support agile development and continuous software delivery. the assessment evaluated the security of this environment. overview the security assessment identified a number of issues in relation to the systems within scope. the most significant issues were assessed to pose a high risk to client and related to misconfigurations of key system components. it is recommended that the identified issues are addressed a s described within this report in order to ensure that the organisation's information assets are suitably protected. this will, in turn, minimise the risk to which client is exposed. the following table breaks down the issues which were identified by phas e and severity of risk (issues which are reported for information only are not included in the totals): phase description critical high medium low total 1 developer scenario assessment 0 1 1 0 2 2 jenkins review 0 2 2 1 5 3 aws configuration review 0 0 9 1 10 4 kubernetes configuration 0 0 3 0 3 total 0 3 15 2 20 assessment summary jenkins and rogue developer scenario review the most significant issues identified in the jenkins review were an authorisation misconfiguration and a security weakness in an authorisation plugin. in combination, these could allow a registered user to gain access to the jenkins instance and all existing jobs. a global security setting granted read permissions to al l authenticated users who were registered with github, even if they were not a member of the organisation. the github oauth plugin had an existing vulnerability that ignored the permission relationships in place and made it possible to access the build output and console log of the jobs by any user. the main concern identified by the rogue developer scenario assessment was that a number of credentials and an ssh private key were found in the github repository. this could allow an attacker to gain access to multiple aws s3 buckets and download sensitive data. aws review the most significant issue identified in the aws review was the use of iam roles which were overly permissive. this could allow a trusted user to el evate their privileges within the account in order to perform actions which they should not be able to perform. it was also observed that the password policy applied to iam users was weaker than recommended . weak password policies typically lead to the creation and use of weak passwords which are m ore susceptible to recovery by brute -force and password guessing attacks. it is acknowledged, however that this risk was mitigated by the use of multi-factor authentication (mfa) across all accounts.version 1.0 - page 3 of 44  a number of other issues where the configuration depart ed from security best practice were noted, although none were assessed to pose more than a medium risk. for example , two issues were noted with regard to the configuration of the s3 buckets. a number of buckets did not encrypt the data they stored while others used a clear text channel for their communications . it should be ensured that any potentially sensitive data is encrypted both when at rest and as it is communicated. kubernetes review only a small number of issues were identified in the kuber netes review. the most significant was that the version of kubernetes in use within the cluster was outdated and so contained a number of security vulnerabilities. while the vulnerable features were not in use, this still illustrates the importance of keeping the installed version of kubernetes up to date and so minimising the risk of becoming vulnerable to newly discovered issues. in addition, the pod security policy and cluster networking rules would benefit from review in order to bring the kubernetes environment into line with security best practice. the remaining issues were all assessed to pose a low risk or are reported for information only. nevertheless, it is recommended that they are all reviewed and addressed so as to bring the environment within scope into line with security best practice. it is important to recognise that even low risk issues can be exploited in combination with other issues as part of a wider attack which seeks to compromise an environment or application. in addition, resolving lower risk issues can have the dual benefit of reducing the attractiveness of systems to opportunistic attackers as well as enhancing the overall security posture. more detailed information on each of the issues which were identified is included in section 2 of this report. strategic recommendations the majority of the identified issues were the result of hosts or systems that did not make the most of the secure configurations available. these should be reconfigured in line with the security best practice guidance provided later in this report. in particular, it is recommended that, in addition to removing any of the insecurely stored credentials which were identifie d, steps should be taken to ensure that no further secrets are stored in github repositories. consideration should also be given to implementing a periodic review of all github repositories for strings of characters which could indicate that secrets have b een exposed. any remedial actions which are undertaken as a result of this assessment should also be reviewed for inclusion in the organisation's secure build standards and deployment procedures. it is recommended that the issues set out in this report should be addressed by a structured programme of remedial actions which are prioritised in accordance with the perceived risk to the organisation.version 1.0 - page 4 of 44  table of contents executive summary ................................................................................................................................ 2 overview ........................................................................................................................................... 2 assessment summary ...................................................................................................................... 2 strategic recommendations ............................................................................................................. 3 table of contents .................................................................................................................................... 4 using this report ................................................................................................................................... 5 document control ................................................................................................................................... 5 1 technical summary .......................................................................................................................... 6 1.1 scope ....................................................................................................................................... 6 1.2 caveats .................................................................................................................................... 6 1.3 post assessment cleanup....................................................................................................... 6 1.4 risk ratings ............................................................................................................................. 7 1.5 findings overview ................................................................................................................... 8 2 technical details ............................................................................................................................. 13 2.1 detailed findings ................................................................................................................... 13 2.1.1 phase 1 - developer scenario assessment ............................................................ 13 ssh private key in s3 bucket ................................................................................. 13 credentials in github repository ............................................................................. 14 good practice observed .......................................................................................... 15 2.1.2 phase 2 - jenkins review ........................................................................................ 16 github oauth misconfiguration ................................................................................ 16 jenkins broken access control................................................................................ 18 outdated jenkins software ...................................................................................... 19 csrf protection disabled ....................................................................................... 20 clear text credentials .............................................................................................. 21 2.1.3 phase 3 - aws configuration review ..................................................................... 23 root account used recently ................................................................................... 23 iam password policy ................................................................................................ 24 ebs volumes without encryption ............................................................................ 26 automated backups not enabled for rds instances .............................................. 27 s3 bucket configuration allowing clear text communications .............................. 28 s3 bucket without default encryption ..................................................................... 30 policy allows "assumerole" action for any resource ........................................... 32 policy allows "passrole" action for any resource ................................................ 34 default security group hardening not implemented ............................................... 36 single availability zone rds instance ..................................................................... 38 2.1.4 phase 4 - kubernetes configuration ........................................................................ 39 kubernetes pod security policy overly permissive ................................................. 39 kubernetes unrestricted cluster network ................................................................ 40 outdated kubernetes in use .................................................................................... 41 3 supplemental data ......................................................................................................................... 42 3.1 credentials in github repository .......................................................................................... 42 3.2 list of the identified credentials ............................................................................................ 42 3.3 ebs volumes without encryption ......................................................................................... 42 4 appendices ..................................................................................................................................... 43 4.1 tool list ................................................................................................................................. 43 4.2 assessment team ................................................................................................................. 44version 1.0 - page 5 of 44  using this report to facilitate the dissemination of the information within this report throughout your organisation, this document has been divided into the following clearly marked and separable sections. document breakdown executive summary management level, strategic overview of the assessment and the risks posed to the business 1 technical summary an overview of the assessment from a more technical perspective, including a defined scope and any caveats which may apply 2 technical details detailed discussion (including evidence and recommendations) for each individual security issue which was identified 3 supplemental data any additional evidence which was too lengthy to include in section 2 4 appendices this section usually includes the security tools which were used, outlines the assessment methodologies and lists the assessment team members document control ity this document contains  information and may not be copied without written permission. proprietary information the content of this document should be considered proprietary information and should not be disclosed outside of client company ltd.. test organization gives permission to copy this report for the purposes of disseminating information within your organisation or any regulatory agency. document version control data classification  client name client company ltd. project reference 9999999 proposal reference o-12345 document title agile development environment security assessment author tsc consultant document history issue no. issue date issued by change description 0.1 29/09/2020 tsc consultant draft for test organization internal review only 0.2 01/10/2020 a reviewer revised qa 1.0 02/10/2020 tsc consultant released to client document distribution list a. sponsor project sponsor, client tsc consultant senior security consultant, test organization a. manager account manager, test organizationversion 1.0 - page 6 of 44  1 technical summary test organization was contracted by client to conduct a security assessment of the systems within scope in order to identify security issues that could negatively affect client's business or reputation if they led to the compromise or abuse of systems. 1.1 scope the security assessment was carried out in the staging environment and included: * security evaluation of a rogue developer scenario * jenkins review * aws configuration review * kubernetes review the url and github within the scope of the jenkins and rogue developer scenario are listed below: * https://project-app-jenkins.staging.clientuk * https://github/clientuk/project the following aws account was reviewed: * 123456789012 the following kubernetes cluster was reviewed: * project-staging 1.2 caveats due to the nature of the environment, checks that would have a high probability o f causing disruption to the named hosts were excluded. denial of service attempts were excluded for the same reason. 1.3 post assessment cleanup the following test accounts which were created for the purpose of this assessment should be disabled or removed, as appropriate, together with any associated content: * testuser1 * testuser2 * testadmin1 * testadmin2 revert any waf/ids/ips/firewall changes which were made for the purposes of the assessment.version 1.0 - page 7 of 44  1.4 risk ratings the table below gives a key to the icons and symbols used throughout this report to provide a clear and concise risk scoring system. it should be stressed that quantifying the overall business risk posed by any of the issues found in any test is outside our remit. this means that some risks may be re ported as high from a technical perspective but may, as a result of other controls unknown to us, be considered acceptable. symbol risk rating cvssv2 score explanation critical 9.0 - 10 a vulnerability was discovered that has been rated as critical. this requires resolution as quickly as possible. high 7.0 - 8.9 a vulnerability was discovered that has been rated as high. this requires resolution in the short term. medium 4.0 - 6.9 a vulnerability was discovered that has been rated as medium. this should be resolved as part of the ongoing security maintenance of the system. low 1.0 - 3.9 a vulnerability was discovered that has been rated as low. this should be addressed as part of routine maintenance tasks. info 0 - 0.9 a discovery was made that is reported for information. this should be addressed in order to meet leading practice. n/a n/a good security practices were being followed or an audit item was found to be present and correct.version 1.0 - page 8 of 44  1.5 findings overview all the issues identified during the assessment are listed below with a brief description and risk rating for each issue. the risk ratings used in this report are defined in section 1.4 risk ratings. phase 1 - developer scenario assessment ref finding risk sr-128-1-1 ssh private key in s3 bucket one ssl private key was identified in the private github repository. whilst the key was not immediately exposed to unauth orised access, storing keys such as this in an online location (and in an unencrypted format) places them at risk of compromise if an attacker gains access to the github account or aws s3 bucket. information could also be disclosed if a client device where the repositories had been cloned were lost or stolen. high sr-128-1-2 credentials in github repository some instances of what appeared to be aws and jfrog passwords or credentials were noted in the private github project repository. whilst it was not possible to establish from the repositories alone whether all of these were in use in production, in general it is not recommended that credentials should be stored in source code repositories in clear text. medium sr-128-1-3 good practice observed it was apparent that security had been a consideration in the development and deployment of the pipeline and its environment. the risk from various security flaws had been effectively mitigated. a number of useful controls and processes were observed to be in place. goodversion 1.0 - page 9 of 44  phase 2 - jenkins review ref finding risk sr-128-2-1 github oauth misconfiguration the github oauth plugin provided authentication and authorisation methods for the jenkins server. the authorisation settings granted read permissions to all authenticated users. this meant th at any user registered with and logged into github could access jenkins, even though the participant in organization setting was originally set to prevent users from outside the organisation being able to access jenkins. high sr-128-2-2 jenkins broken access control jenkins extends its functionality with plugins that can be developed by third party companies or by individuals. the github oauth plugin was identified as being responsible for authentication and authorisation. however, this plugin contained a bug that ignored the permission relationships and allowed any users to access data, even when this should have been denied as a result of that user's permissions. high sr-128-2-3 outdated jenkins software the installed version of jenkins server was outdated and affected by a number of security vulnerabilities. the observed version of the jenkins was 2.231 while the latest version (at the time of writing) is 2.259. known software vulnerabilities which were unpatched in the observed version included csrf and xss we aknesses. known issues also included missing permissions checks and the potential disclosure of smtp passwords. medium sr-128-2-4 csrf protection disabled the built-in jenkins csrf token had not been enabled. this increases the risk of a successful csrf attack which could allow an attacker to manipulate a user or an administrator into unwittingly performing actions within the application (such as changing the account password, adding accounts to the system and changing settings) on behalf of the attacker. medium sr-128-2-5 clear text credentials jenkins uses the workspace directory to build projects, to store the checkout source code and to store the files generated by the build itself. however, some files in the workspace directory were not automatically deleted. some of these remaining files included credentials in clear text format, and had world readable permissions. lowversion 1.0 - page 10 of 44  phase 3 - aws configuration review ref finding risk sr-128-3-1 root account used recently it was confirmed that the "root" account had been used recently as part of the security checks of the amazon console. amazon security best practice recommends that this account should only be used when strictly necessary. other accounts with more suitably restricted permissions should be used for daily administrative duties. medium sr-128-3-2 iam password policy weaknesses were noted in the password policy enabled in the iam settings. this could result in the creation of weak user passwords, more easily susceptible to recovery by an attacker. furthermore, these settings could allow a weak password to be used for an extended period of time. medium sr-128-3-3 ebs volumes without encryption elastic block store (ebs) based full disk encryption (fde) was not enabled on the ebs volumes. due to the nature of a cloud-hosted environment, hosted data stored on virtual drives can be re -assigned to other hosts, often beyond the account that owns it. if an administrator removes a virtual drive from a hosted machine, this data can be re-assigned elsewhere and in some circumstances recovered. medium sr-128-3-4 automated backups not enabled for rds instances automated backups had not been enabled for a number of relational database service (rds) instances. this feature facili tates the creation of periodic rds instance snapshots, which in turn ensure that data restoration is possible in the event of an incident affecting the source database. medium sr-128-3-5 s3 bucket configuration allowing clear text communications the observed configuration for several s3 buckets did not enforce the use of ssl/tls connections, or prevent clients from connecting over clear text protocols. communication between clients and s3 buckets could use unencrypted http as well as https as the use of https was not enforced. as a result, sensitive information could be transmitted in clear text over the network. medium sr-128-3-6 s3 bucket without default encryption analysis of the s3 configuration indicated that a number of buckets did not have default encryption enabled. s3 default encryption provides a way to set the default encryption behaviour for an s3 bucket. when enabled, all objects will be encrypted when they are stored in the bucket. this will be done automatically, without having to construct a bucket policy that rejects objects that are not encrypted. medium sr-128-3-7 policy allows "assumerole" action for any resource one of the iam inline securit y policies reviewed during the assessment included the assumerole action, without limiting it to a specific resource. the security token service (sts) is a service that enables requesting temporary, limited - privilege credentials for users. the assumerole a ction implemented by the sts returns a set of temporary credentials that can be used to access aws resources. a user, group or role with access to this action through the identified policies would be allowed to assume any role in any account that trusts th e user's account. this is contrary to the principle of least privilege, as suggested by aws security best practice. mediumversion 1.0 - page 11 of 44  ref finding risk sr-128-3-8 policy allows "passrole" action for any resource a number of the iam managed and inline security policies reviewed during the assessment included the "passrole" action, without limiting it to a specific resource. to pass a role (and its permissions) to an aws service, a user must have permissions to pass the role to the ser vice. this helps administrators ensure that only approved users can configure a service with a role that grants permissions. creating a policy that includes the "passrole" permission without restrictions could enable the entity to which this policy is attached to access resources to which it has not been granted explicit access. this is contrary to the principle of least privilege, as suggested by aws security best practice. medium sr-128-3-9 default security group hardening not implemented a number of security groups were identified to be using the default rules, allowing all inbound traffic from instances assigned to the same security group, as well as all outbound traffic. the default security group is assigned to new instances created within a vpc if no custom security groups are assigned to it during configuration. these rules may be overly permissive, for instance allowing an attacker who has compromised one instance with the default security group assigned to use horizontal privilege escalation to compromise all other instances configured with the default security group. medium sr-128-3-10 single availability zone rds instance one relational database service (rds) instance was configured without the multi availability zone option enabled. without this, should an availability zone specific database failure occur, then amazon rds cannot automatically fail over to the standby availability zone so that database operations can resume quickly without administrative intervention. lowversion 1.0 - page 12 of 44  phase 4 - kubernetes configuration ref finding risk sr-128-4-3 outdated kubernetes in use the kubernetes service was found to be out of date, leaving the clusters and their respective containers potentially open to both security and functional issues that have been patched in later versions. medium sr-128-4-1 kubernetes pod security policy overly permissive the cluster did make use of the kubernetes pod security policy feature, but was configured to allow any user to create privileged containers. as a result, any user with the ability to create new pods on the cluster would be able to gain privileged access to the underlying cluster nodes and any secrets contained within them. medium sr-128-4-2 kubernetes unrestricted cluster network there were no egress restrictions on traffic from pods in the cluster network. as a result, a compromised container would be able to attack kubernetes' management interfaces. mediumversion 1.0 - page 13 of 44  2 technical details the remainder of this document is technical in nature and provides additional detail about the items already discussed, for the purposes of remediation and risk assessment. 2.1 detailed findings 2.1.1 phase 1 - developer scenario assessment sr-128-1-1 ssh private key in s3 bucket risk rating high ssh private key in s3 bucket description: one ssl private key was identified in the private github repository. whilst the key was not immediately exposed to unauthorised access, storing keys such as this in an online location (and in an unencrypted format) places them at risk of compromise if an attacker gains access to the github account or aws s3 bucket. information could also be disclosed if a client device where the repositories had been cloned were lost or stolen. recommendation: ensure that all ssl private keys which will be used in test, staging and production environments are store d securely and not exposed on public facing systems such as a github repository or in aws s3 buckets. affects: s3 bucket name s3://dev.client.comversion 1.0 - page 14 of 44  sr-128-1-2 credentials in github repository risk rating medium credentials in github repository some instances of what appeared to be aws and jfrog passwords or credentials were noted in the private github project repository. whilst it was not possible to establish from the repositories alone whether all of these were in use in production, in general it is not recommended that credentials should be stored in source code repositories in clear text. instances of passwords stored in cloud formation template files: https://github/clientuk/project/develop/config https://github/clientuk/project/develop/deployment/fullstart.json additionally, a hard-coded password was noted in python and shell scripts: https://github/clientuk/project/develop/scripts/s3_pull.py https://github/clientuk/project/develop/deployment/s3_pull_t.py it was not possible to perform any successful privilege escalation with these credentials. the aws credentials were for roles or iam users with s3 buckets who were accorded only limited permissions. a list of the files found to contain passwords is available in supplemental data, section 3.1. recommendation: ensure that credentials are not stored in clear text in github repositories or in aws s3 buckets. affects: github repository projectversion 1.0 - page 15 of 44  sr-128-1-3 good practice observed risk rating good good practice observed description: it was apparent that security had been a consideration in the development and deployment of the pipeline and its environment. the risk from various security flaws had been effectively mitigated. a number of useful controls and processes were observed to be in place. these included: * enforced code reviews * defined checks for committing * separate teams were responsible for different systems * developers could not bypass pipeline steps to introduce new code or change existing code * the use of multi-factor authentication was enforced for all aws and github access recommendation: ensure that these practices are maintained by means of training programmes and supporting procedures which define secure and acceptable practices within the organisation.version 1.0 - page 16 of 44  2.1.2 phase 2 - jenkins review sr-128-2-1 github oauth misconfiguration risk rating high github oauth misconfiguration description: the github oauth plugin provided authentication and authorisation methods for the jenkins server. the authorisation settings granted read permissions to all authenticated users. this meant that any user registered with and logged into github could access jenkins, even though the participant in organization setting was originally set to prevent users from outside the organisation being able to access jenkins. figure 1 -read permissions granted to all authenticated users it was possible to exploit this issue in combination with the security weakness described in the jenkins broken access control issue in order to gain access to the build output from all jobs. figure 2 - accessing jenkins with a user who was not a member of the organizationversion 1.0 - page 17 of 44  recommendation: remove the read permissions to all authenticated users in the global security settings. affects: dns name project-app-jenkins.staging.clientuk references: github oauth plugin https://wiki.jenkins.io/display/jenkins/github+oauth+pluginversion 1.0 - page 18 of 44  sr-128-2-2 jenkins broken access control risk rating high jenkins broken access control description: jenkins extends its functionality with plugins that c an be developed by third party companies or by individuals. the github oauth plugin was identified as being responsible for authentication and authorisation. however, this plugin contained a bug that ignored the permission relationships and allowed any users to access data , even when this should have been denied as a result of that user's permissions. figure 3 - current user had no access to job details by default figure 4 - bypassing restriction using the available third party url recommendation: apply the workaround in the references or consider using a different authorisation and authentication plugin (after testing has provided a suitable level of assurance). affects: dns name project-app-jenkins.staging.clientuk references: github oauth plugin bug https://issues.jenkins-ci.org/browse/jenkins-54031version 1.0 - page 19 of 44  sr-128-2-3 outdated jenkins software risk rating medium outdated jenkins software description: the installed version of jenkins server was outdated and affected by a number of security vulnerabilities. the observed version of the jenkins was 2. 231 while the latest version (at the time of writing) is 2. 259. known software vulnerabilities which were unpatched in the observed version included csrf and xss weaknesses. known issues also included missing permissions checks and the potential disclosure of s mtp passwords. these vulnerabilities could allow an attacker to steal the session of an administrator, gain access to sensitive information or create files and potentially execute code on the host system. this issue has been rated as a medium risk to reflect these issues and their assigned cvss scores. recommendation: update the version of the affected jenkins server to the latest stable and secure version available. perform any testing necessary to ensure that this does not break or conflict with required functionality. review the current policy for upgrading jenkins servers and create a plan that ensures jenkins can be maintained at the latest stable version, while still ensuring adequate testing so as to minimise disruption. affects: dns name project-app-jenkins.staging.clientuk references: jenkins security advisory 2020-08-12 https://www.jenkins.io/security/advisory/2020-08-12/ jenkins website: changelog https://jenkins.io/changelog/ https://jenkins.io/changelog-stable/version 1.0 - page 20 of 44  sr-128-2-4 csrf protection disabled risk rating medium csrf protection disabled description: the built-in jenkins csrf token had not been enabled. this increases the risk of a successful csrf attack which could allow an attacker to manipulate a user or an administrator into unwittingly performing actions within the application (such as changing the account password, adding accounts to the system and changing settings) on behalf of the attacker. figure 5 - crsf protection option not enabled for a csrf attack to succeed, the victim must click a malicious link or visit a malicious web page while logged in to the vulnerable application. this would cause the victim's browser to issue get or post requests to the vulnerable site by means of hidden images or embedded javascript code. as far as the application is concerned, these forged requests would appear to be the result of genuine actions performed by real users clicking on elements within the application. this is because the application did not sufficiently validate requests (such as by means of random tokens) to allow it to make this distinction. recommendation: enable the csrf token protection in jenkins. one time tokens are t he primary defence against csrf . tokens are validated server-side to ensure that requests can only be executed once. the token which is received must match the server -side information. affects: dns name project-app-jenkins.staging.clientuk references: jenkins csrf protection https://wiki.jenkins.io/display/jenkins/csrf+protection remote access api https://wiki.jenkins.io/display/jenkins/remote+access+api jenkins csrf protection explained https://support.cloudbees.com/hc/en-us/articles/219257077-csrf-protection-explainedversion 1.0 - page 21 of 44  sr-128-2-5 clear text credentials risk rating low clear text credentials description: jenkins uses the workspace directory to build projects, to store the checkout source code and to store the files generated by the build itself. however, some files in the workspace directory w ere not automatically deleted . some of these remaining files included credentials in clear text format, and had world readable permissions. figure 6 - example file containing api key in the workspace directory figure 7 - some files had world readable permissions in the workspace directory this could allow an attacker with ssh or script console access to recover credentials to different systems. recommendation: use the workspace cleanup plugin to remove files that conta in credentials such as docker configuration file s or shell scripts. affects: dns name project-app-jenkins.staging.clientukversion 1.0 - page 22 of 44  references: workspace cleanup plugin https://wiki.jenkins.io/display/jenkins/workspace+cleanup+plugin how to use workspace cleanup plugin https://blog.clairvoyantsoft.com/jenkins-cleanup-workspace-reduce-disk-usage-18310097d3efversion 1.0 - page 23 of 44  2.1.3 phase 3 - aws configuration review sr-128-3-1 root account used recently risk rating medium root account used recently description: it was confirmed that the "root" account had been used recently as part of the security checks of the amazon console. amazon security best practice recom mends that this account should only be used when strictly necessary. other accounts with more suitably restricted permissions should be used for daily administrative duties. the following screenshot demonstrates that the root account was used recently on t he 2020-08-12: figure 8 - root account usage the use of the root account was discussed with client staff, who revealed that the use of the root account is part of a corporate account, and project staff had no direct control over the account. recommendation: the use of the root account should be minimised. other accounts should be created following the principle of least privilege and used for management. this will reduce the risk of accidental changes and unintended disclosure of highly privileged credentials. this would also better align the aws account with amazon recommended security best practice. affects: aws account 123456789012:root references: aws identity and access management (iam) https://aws.amazon.com/iam/ aws identity and access management documentation https://aws.amazon.com/documentation/iam/ aws documentation - iam best practices http://docs.aws.amazon.com/iam/latest/userguide/iambestpractices.html cis amazon web services foundations https://d0.awsstatic.com/whitepapers/compliance/aws_cis_foundations_benchmark.pdfversion 1.0 - page 24 of 44  sr-128-3-2 iam password policy risk rating medium iam password policy description: weaknesses were noted in the password policy enabled in the iam settings. this could result in the creation of weak user passwords , more easily susceptible to recovery by an attacker . furthermore, these settings could allow a weak password to be used for an extended period of time. the following screenshot illustrates the password policy settings that were observed. note that the check boxes for the options prevent password reuse, require at least one non-alphanumeric character and enable password expiration were not selected: figure 9 - password policy not enforced the prevent password reuse option will not allow a user to reuse a previous password value when setting a new password (which otherwise might allow continued use of the same password). the number of previous passwords which are not allowed can be set between 1 and 24. passwords can be set to expire after a period between 1 and 1095 days. it is worth noting that some more recent password guidance suggests not setting passwords to expire, but that this advice is given in the expectation that all passwords are of suitably strong and that other controls (such as mfa) are used where appropriate. recommendation: ensure a strong password policy is in place. specifically, ensure that the following password policy is enforced: * passwords should include at least one symbol * passwords cannot be reused * passwords should be reused * passwords should use mixed case * passwords should include at least one number * passwords require minimum length of 14 charactersversion 1.0 - page 25 of 44  affects: aws account 123456789012 references: aws identity and access management (iam) https://aws.amazon.com/iam/ aws identity and access management documentation https://aws.amazon.com/documentation/iam/ aws documentation - managing passwords http://docs.aws.amazon.com/iam/latest/userguide/credentials-managingpasswords.htmlversion 1.0 - page 26 of 44  sr-128-3-3 ebs volumes without encryption risk rating medium ebs volumes without encryption description: elastic block store (ebs) based full disk encryption (fde) was not enabled on the ebs volumes. due to the nature of a cloud -hosted environment, hosted data stored on virtual drives can be re -assigned to other hosts, often beyond the account that owns it. i f an administrator removes a virtual drive from a hosted machine, this data can be re-assigned elsewhere and in some circumstances recovered. amazon have stated that drives are wiped after deletion; however, fde ensures that if a virtual drive is removed and re-assigned to a different host controlled by another aws account then this data would be very difficult, if not impossible, to recover. the following figure highlights the volumes that did not have encryption enabled: figure 10 - ebs volumes lacking encryption 114 volumes were flagged and are detailed in supplemental data, section 3.3. recommendation: encrypt all hosted machine virtual drives that host intellectual property or sensitive data. furthermore, os based encryption (such as luks or bitlocker) ca n be leveraged in order to mitigate the risk from this issue. affects: see supplemental data, section 3.3. references: amazon ec2 https://aws.amazon.com/ec2/ amazon elastic compute cloud documentation https://aws.amazon.com/documentation/ec2/ aws security whitepaper - elastic block storage security (page 24) https://d0.awsstatic.com/whitepapers/aws-security-whitepaper.pdf aws documentation - amazon elastic block store (amazon ebs) https://docs.aws.amazon.com/awsec2/latest/userguide/amazonebs.htmlversion 1.0 - page 27 of 44  sr-128-3-4 automated backups not enabled for rds instances risk rating medium automated backups not enabled for rds instances automated backups had not been enabled for a number of relational database service (rds) instances. this feature facilitates the creation of periodic rds instance snapshots, which in turn ensure that data restoration is possible in the event of an incident affecting the source database. the following screenshot from the aws trusted advisor shows that the main-components-db-stage and region-components-db-stage rds instances had automated backups disabled: figure 11 - rds instances with automated backups disabled recommendation: ensure that all rds database instances that host sensitive data have automated backups enabled for point -in- time recovery. affects: rds instance main-components-db-stage region-components-db-stage references: amazon relational database service (rds) https://aws.amazon.com/rds/ amazon relational database service documentation https://aws.amazon.com/documentation/rds/ aws documentation - backing up and restoring amazon rds db instances https://docs.aws.amazon.com/amazonrds/latest/userguide/chap_commontasks.backuprestore.htmlversion 1.0 - page 28 of 44  sr-128-3-5 s3 bucket configuration allowing clear text communications risk rating medium s3 bucket configuration allowing clear text communications description: the observed configuration for several s3 buckets did not enforce the use of ssl/tls connections, or prevent clients from connecting over clear text protocols. communication between clients and s3 buckets could use unencrypted http as well as https as the use of https was not enforced. as a result, sensitive information could be transmitted in clear text over the network. the following buckets were found not to enforce the use of encrypted communication: * project-jenkins-stage * project-xa-jenkins-stage * project-xb-jenkins-stage the following screenshot shows the policy for one of the buckets listed above: figure 12 - policy allowing clear text communications this configuration presents an opportunity for an intercepting party to capture sensitive data. in general, any data that is in any way sensitive should only be communicated over https. recommendation: the use of clear text protocols should be prevented by enforcing tls as a transport method. adding the following statement to a bucket configuration will ensure objects can only be accessed over tls connections. { "statement":[ { "action": "s3:*", "effect":"deny", "principal": "*", "resource":["arn:aws:s3:::<bucketname>", "arn:aws:s3:::<bucketname>/*"], "condition":{ "bool": { "aws:securetransport": false } } } ] } affects: s3 buckets project-jenkins-stage project-xa-jenkins-stage project-xb-jenkins-stageversion 1.0 - page 29 of 44  references: amazon s3 https://aws.amazon.com/s3/ amazon simple storage service documentation https://aws.amazon.com/documentation/s3/ aws documentation - aws global and iam condition context keys https://docs.aws.amazon.com/iam/latest/userguide/reference_policies_condition-keys.html aws documentation - iam json policy elements: condition operators https://docs.aws.amazon.com/iam/latest/userguide/reference_policies_elements_condition_operators.html aws documentation - iam policy elements: variables https://docs.aws.amazon.com/iam/latest/userguide/reference_policies_variables.htmlversion 1.0 - page 30 of 44  sr-128-3-6 s3 bucket without default encryption risk rating medium s3 bucket without default encryption description: analysis of the s3 configuration indicated that a number of buckets did not have default encryption enabled. s3 default encryption provides a way to set the default encryption behaviour for an s3 bucket. w hen enabled, all objects will be encrypted when they are stored in the bucket. this will be done automatically, without having to construct a bucket policy that rejects objects that are not encrypted. the following buckets were found not to have default encryption enabled: * project-jenkins-stage * project-xa-jenkins-stage * project-xc-jenkins-stage * project-y99-jenkins-stage * project-za-jenkins-stage * project-xab-jenkins-stage * project-zd-jenkins-stage the following screenshot shows an s3 bucket with default encryption not enabled: figure 13 - bucket without default encryption enabled it was noted that default encryption was enabled on other s3 buckets configured on the system. recommendation: enable default encryption on all s3 buckets. affects: s3 buckets project-jenkins-stage project-xa-jenkins-stage project-xc-jenkins-stage project-y99-jenkins-stage project-za-jenkins-stage project-xab-jenkins-stage project-zd-jenkins-stage references: amazon s3 https://aws.amazon.com/s3/ amazon simple storage service documentation https://aws.amazon.com/documentation/s3/ aws documentation - using encryption https://docs.aws.amazon.com/amazons3/latest/dev/usingencryption.html aws documentation - how do i create an s3 bucket? https://docs.aws.amazon.com/amazons3/latest/user-guide/create-bucket.htmlversion 1.0 - page 31 of 44  aws documentation - amazon s3 default encryption for s3 buckets https://docs.aws.amazon.com/amazons3/latest/dev/bucket-encryption.html aws news blog - new amazon s3 encryption & security features https://aws.amazon.com/blogs/aws/new-amazon-s3-encryption-security-features/version 1.0 - page 32 of 44  sr-128-3-7 policy allows "assumerole" action for any resource risk rating medium policy allows "assumerole" action for any resource description: one of the iam inline security policies reviewed during the assessment included the assumerole action, without limiting it to a specific resource. the security token service (sts) is a service that enables requesting temporary, limited-privilege credentials for users. the assumerole action implemented by the sts returns a set of temporary credentials that can be used to access aws resources. a user, group or role with access to this action through the identified policies would be allowed to assume any role in any account that trusts the user's account. this is contrary to the principle of least privilege, as suggested by aws security best practice. the following security policy was affected by this issue: * arn:aws:iam::123456789012:policy/jenkins-policy the following statement was included in this policy: { "action": [ "sts:assumerole" ], "effect": "allow", "resource": [ "*" ] } if resource is set to * as in the case above, then the user receiving this policy can assume any role in any account that trusts the user's aws account ( that is, the role's trust policy specifies the user's account as principal). recommendation: the policies affected by this issue should be reviewed. one potential mitigation is to specify the complete arn of the role that the user should be allowed to assume. for example, the following policy sets this restriction: { "version": "2012-10-17", "statement": { "effect": "allow", "action": "sts:assumerole", "resource": "arn:aws:iam::<account-id>:role/[role to be assumed]" } } this helps prevent the user from assuming roles that have more permissions than the user has been granted - that is, from being able to obtain elevated privileges. affects: iam policy jenkins-policy references: aws identity and access management (iam) https://aws.amazon.com/iam/version 1.0 - page 33 of 44  aws identity and access management documentation https://aws.amazon.com/documentation/iam/ aws documentation - granting a user permissions to switch roles http://docs.aws.amazon.com/iam/latest/userguide/id_roles_use_permissions-to-switch.html aws documentation - assumerole https://docs.aws.amazon.com/sts/latest/apireference/api_assumerole.htmlversion 1.0 - page 34 of 44  sr-128-3-8 policy allows "passrole" action for any resource risk rating medium policy allows "passrole" action for any resource description: a number of the iam managed and inline security policies reviewed during the assessment included the "passrole" action, without lim iting it to a specific resource. to pass a role (and its permissions) to an aws service, a user must have permissions to pass the role to the service. this helps administrators ensure that only approved users can configure a service with a role that grants permissions. creating a policy that includes the "passrole" permission without restrictions could enable the entity to which this policy is attached to access resources to which it has not been granted explicit access. this is contrary to the principle of least privilege, as suggested by aws security best practice. the following security policies were affected by this issue: * arn:aws:iam::123456789012:role/jenkins-role * arn:aws:iam::123456789012:role/jenkins-role1 the following "passrole" permission was configured for the jenkins-role policy: { "action": [ "iam:addroletoinstanceprofile", "iam:attachrolepolicy", "iam:createinstanceprofile", "iam:createpolicy", "iam:createrole", "iam:deletepolicy", "iam:deleterole", "iam:detachrolepolicy", "iam:getpolicy", "iam:getrole", "iam:listattachedrolepolicies", "iam:listpolicies", "iam:listroles", "iam:passrole", "iam:putrolepolicy", "iam:updateassumerolepolicy" ], "effect": "allow", "resource": [ "*" ] } , if resource is set to "*" as in the case above, then the user can pass any role. for example, imagine that a user has permissions only to launch ec2 instances, but the roles that the user can pass to an ec2 instance have permissions to work with iam and amazon s3. in this case, the user might be able to launch the instance, log into it, get temporary security credentials and then perform iam or s3 acti ons for which that the user is not authorised. recommendation: the policies affected by this issue should be reviewed. one potential mitigation is to specify the complete arn of the role that the user should be allowed to pass. for example, the following policy sets this restriction:version 1.0 - page 35 of 44  { "version": "2012-10-17", "statement": [{ "effect": "allow", "action": [ "iam:getrole", "iam:passrole" ], "resource": "arn:aws:iam::<account-id>:role/<role-name>" }] } this helps prevent the user from running applications that have more permissions than the user has been granted - that is, from being able to obtain elevated privileges. affects: iam policy jenkins-role jenkins-role1 servicerolepolicy autoscalingclusterpolicy references: aws identity and access management (iam) https://aws.amazon.com/iam/ aws identity and access management documentation https://aws.amazon.com/documentation/iam/ aws documentation - granting a user permissions to pass a role to an aws service https://docs.aws.amazon.com/iam/latest/userguide/id_roles_use_passrole.html aws documentation - pass role permissions https://docs.aws.amazon.com/iot/latest/developerguide/pass-role.html aws documentation - using an iam role to grant permissions to applications running on amazon ec2 instances https://docs.aws.amazon.com/iam/latest/userguide/id_roles_use_switch-role-ec2.html aws security blog - granting permission to launch ec2 instances with iam rol es (passrole permission) https://aws.amazon.com/blogs/security/granting-permission-to-launch-ec2-instances-with-iam-roles-passrole-permissionversion 1.0 - page 36 of 44  sr-128-3-9 default security group hardening not implemented risk rating medium default security group hardening not implemented description: a number of security groups were identified to be using the default rules, allowing all inbound traffic from instances assigned to the same security group, as well as all outbound traffic. the default security group is assigned to new instances created withi n a vpc if no custom security groups are assigned to it during configuration. these rules may be overly permissive, for instance allowing an attacker who has compromised one instance with the default security group assigned to use horizontal privilege esca lation to compromise all other instances configured with the default security group. as can be seen in the following screenshot from an test organization internal tool used during the assessment, the default security group had permissive rules defined: figure 14 - rules present in default security group the following vpcs were found to have default security groups configured with the default rules: * region 1: vpc 1 vpc 5 * region 2: vpc a vpc b it is good security practice to harden the default security group by removing all rules. any new instance created within a vpc will then be unable to communicate with other instances until custom security groups (conforming to security best practice) have been assigned. recommendation: in order to improve system hardening, remove all rules from the default security group so that it restricts all traffic. should an instance be created without custom security groups, it will inherit the default security grou p and be unable to communicate with other instances within the vpc until the required custom security groups are assigned. each vpc should be configured with custom security groups that conform to the practice of 'least privilege'. these custom security groups should be assigned on a case-by-case basis to the instances that require them, allowing communication within instances and to the wider internet under tightly controlled conditions.version 1.0 - page 37 of 44  affects: ip address vpc 1 vpc 5 vpc a vpc b references: amazon virtual private cloud https://aws.amazon.com/vpc/ amazon virtual private cloud documentation https://aws.amazon.com/documentation/vpc/ aws documentation - security groups for your vpc https://docs.aws.amazon.com/amazonvpc/latest/userguide/vpc_securitygroups.html cis amazon web services foundations https://d0.awsstatic.com/whitepapers/compliance/aws_cis_foundations_benchmark.pdfversion 1.0 - page 38 of 44  sr-128-3-10 single availability zone rds instance risk rating low single availability zone rds instance description: one relational database service (rds) instance was configured without the multi availability zone option enabled. without this, should an availabili ty zone specific database failure occur, then amazon rds cannot automatically fail over to the standby availability zone so that database operations can resume quickly without administrative intervention. the following database instance was configured with multi-az disabled: * components-db-stage the following screenshot shows that multi-az was disabled for the instance listed above: figure 15 - rds availability zones recommendation: consideration should be given to modifying the configuration of the database instance to enable multi-az. this is especially important if the applications using the database require high availability. affects: rds instance components-db-stage references: amazon relational database service (rds) https://aws.amazon.com/rds/ amazon relational database service documentation https://aws.amazon.com/documentation/rds/ aws documentation - high availability (multi-az) https://docs.aws.amazon.com/amazonrds/latest/userguide/concepts.multiaz.htmlversion 1.0 - page 39 of 44  2.1.4 phase 4 - kubernetes configuration sr-128-4-1 kubernetes pod security policy overly permissive risk rating medium kubernetes pod security policy overly permissive description: the cluster did make use of the kubernetes pod security policy feature , but was configured to allow any user to create privileged containers. as a result, any user with the ability to create new pods on the cluster would be able to gain privileged access to the underlying cluster nodes and any secrets contained within them. kubernetes provides this feature to restrict the privileges which can be granted by users to newly created pods. this can be used to prevent mounting of host file systems and other rights, which could allow unauthorised access to the underlying operating system running on the cluster nodes. the policies configured within the project-staging cluster did not force pods to run as non-root users, and allowed privileged containers to be created and run. the output below provides evidence of the affected configuration option: <redacted> recommendation: ensure that a pod security policy is defined for all namespaces in the cluster. this policy should provide minimal rights restricting the ability of pods to gain escalated privileges within the cluster. affects: cluster name project-staging references: cis kubernetes benchmark - check 1.1.24 https://www.cisecurity.org/benchmark/kubernetes/ kubernetes pod security policies https://kubernetes.io/docs/concepts/policy/pod-security-policy/ effective implantation of pod security policies https://octetz.com/posts/setting-up-pspsversion 1.0 - page 40 of 44  sr-128-4-2 kubernetes unrestricted cluster network risk rating medium kubernetes unrestricted cluster network description: there were no egress restrictions on traffic from pods in the cluster network. as a result, a compromised container would be able to attack kubernetes' management interfaces. by default, kubernetes clusters provide an unrestricted flat network for all pods running on them. this can be restricted in recent versions by using kubernetes net work policies. these policies can be defined to restrict inbound and outbound access from the pods running on the cluster. as this feature was not in place it was possible to contact services running in the cluster and the management services running on the nodes. recommendation: ensure that kubernetes network policies are in place for all services running on the cluster. these policies should be constructed on a 'least privilege' basis to allow only required traffic. affects: cluster name project-staging references: cis kubernetes benchmark check 1.6.2 https://www.cisecurity.org/benchmark/kubernetes/ kubernetes network policy https://kubernetes.io/docs/concepts/services-networking/network-policies/version 1.0 - page 41 of 44  sr-128-4-3 outdated kubernetes in use risk rating medium outdated kubernetes in use description: the kubernetes service was found to be out of date, leaving the clusters and their respective containers potentially open to both security and functional issues that have been patched in later versions. due to its very fast development rate, vulnerabilities that are found in kubernetes often apply to numerous versions; however, patches are usually released soon after to remediate any current issues. issues disclosed in previous versions have included privilege escalation and information disclosure issues, some of which could potentially allow a malicious user to take full control of a cluster. although no significant vulnerabilities were found in the observed versions of kubernetes, it is strongly recommended that all clusters are kept up to date, in line with security best practice. the code snippet below shows the current version of the kubernetes clusters under review: server version: version.info{major:"1", minor:"16", gitversion:"v1.16.2", gitcommit:" xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", gittreestate:"clean", builddate:"2019-10-20t09:56:31z", compiler:"gc", platform:"linux/amd64"} recommendation: review the current patching policy for kubernetes and ensure that all clusters are updated to the latest stable version regularly. it should also be noted that the current support life cycle length for versions of kubernetes is nine months. affects: cluster project-stagingversion 1.0 - page 42 of 44  3 supplemental data the section below contains additional data that has been removed from the main body of the report for ease of readability. 3.1 credentials in github repository the files which were found to contain credentials are listed below: <redacted> 3.2 list of the identified credentials the following credentials were found in various github files: <redacted> 3.3 ebs volumes without encryption <redacted>version 1.0 - page 43 of 44  4 appendices 4.1 tool list the following tools were used during the assessment: tools used description awscli the aws command line interface https://aws.amazon.com/cli/ burp suite pro intercepting proxy and web application scanner https://portswigger.net/ curl open source command line tool and library for transferring data with url syntax https://curl.haxx.se kali linux security-focussed linux distribution (successor to backtrack linux) https://www.kali.org/ test organization internal tool security auditing tool for aws environments nessus vulnerability scanner https://www.tenable.com/products/nessus nmap open source port scanner https://nmap.org/ udp-proto-scanner udp service discovery tool https://labs.portcullis.co.uk/application/udp-proto-scanner/version 1.0 - page 44 of 44  4.2 assessment team the following members of staff were assigned to this assessment: name job title comments tsc consultant senior security consultant crest registered tester (crt), aws certified security - specialty, crest certified simulated attack specialist (ccsas)