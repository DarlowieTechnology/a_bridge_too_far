{
  "NCCGRPPHP-001": "NCCGRPPHP-001 Outdated or Unsupported Third Party Software\nRisk Rating High Status Open\nDescription:\nA number of third party software packages in the source code repositories were outdated or unsupported and some\nwere affected by publicly reported security vulnerabilities. This indicates there may be a gap within the security patching process. A full breakdown of the outdated third-party software at the time of the assessment has been provided in Affected Resources section. Recommendation:\nInvestigate the software patching and update policy and ensure that updates are applied to all software installations,\nincluding third party applications, on a regular basis. Consideration should be given to enabling the auto-update\nfunctionality within the affected third party software, to ensure that updates are applied quickly and regularly.1\nWhere software is no longer supported, it may be necessary to initiate a programme of work to investigate the most\neffective path towards the use of later, or alternative, supported software.\nAffects:\nThird-party Software Version Supported Version URL\nNodeJS (docker image\ncircleci/node)\n10.8 12 https://nodejs.org/en/about/\nreleases/\nPython (docker image\ncircleci/python)\n2.7 3.9 https://www.python.org/\ndownloads/\nGolang (docker image\ncircleci/golang)\n1.10 1.16.6 https://github.com/golang/go/\nreleases\nPHP 7.3 7.4.22 https://www.php.net/\nindex.php#id2021-07-29-2\naws/aws-sdk-php 2.8.31 3.186.3 https://github.com/aws/\naws-sdk-php/releases/tag/3.186.3\nbeberlei/assert v3.2.1 v3.3.1 https://github.com/beberlei/\nassert/releases/tag/v3.3.1\nbriannesbitt/Carbon 1.21.0 2.51.1 https://github.com/briannesbitt/\nCarbon/releases/tag/2.51.1\ncomposer/installers v1.10.0 v1.11.0 https://github.com/composer/\ninstallers/releases/tag/v1.11.0\ndragonmantank/cron-expression v2.2.0 v3.1.0 https://github.com/\ndragonmantank/cron-expression/\nreleases/tag/v3.1.0\ndoctrine/cache 1.6.2 https://github.com/doctrine/\ncache/releases/tag/2.1.1\n1Checking for Outdated Third-party Packages: https://github.com/FriendsOfPHP/security-advisories#checking-for-vulnerabilities\nVersion 1.0- Page 6 of 33 Client Confidential\nThird-party Software Version Supported Version URL\nfacebook/graph-sdk 5.6.1 https://github.com/\nfacebookarchive/php-graph-sdk/\nreleases/tag/5.7.0\nfirebase/php-jwt 5.0.0 5.4.0 https://github.com/firebase/\nphp-jwt/releases/tag/v5.4.0\nfluent/fluent-logger-php v0.3.8 v1.0.1 https://github.com/fluent/fluent-\nlogger-php/releases/tag/\nv1.0.1\nfzaninotto/faker 1.7.1 Package fzaninotto/faker is\nabandoned\ngemorroj/archive7z 2.0.0 https://github.com/Gemorroj/\nArchive7z/releases/tag/5.1.1\nprotocolbuffers/protobuf-php 3.15.8 v3.17.3 https://github.com/\nprotocolbuffers/protobuf-php/\nreleases/tag/v3.17.3\ngoogleapis/common-protos-php 1.3 1.3.1 https://github.com/googleapis/\ncommon-protos-php/releases/\ntag/1.3.1\ngoogleapis/\ngoogle-auth-library-php\nv1.7.1 v1.16.0 https://github.com/googleapis/\ngoogle-auth-library-php/releases/\ntag/v1.16.0\ngoogleapis/google-cloud-php v0.147.0 v0.163.1 https://github.com/googleapis/\ngoogle-cloud-php/releases/tag/\nv0.163.1\ngrpc/grpc-php 1.36 1.39.0 https://github.com/grpc/\ngrpc-php/releases/tag/v1.39.0\nguzzle/guzzle 3.7.0 guzzle/guzzle is abandoned\nguzzlehttp/psr7 1.4.2 2.0.0 https://github.com/guzzle/psr7/\nreleases/tag/2.0.0\nparagonie/constant_time_encodi\nng\nv2.2.3 v2.4.0 https://github.com/paragonie/co\nnstant_time_encoding/releases/ta\ng/v2.4.0\nphp-fig/cache 1.0.1 3.0.0 https://github.com/php-fig/cache/\nreleases/tag/3.0.0\nphp-fig/container 1.0.0 1.1.1 https://github.com/php-fig/\ncontainer/releases/tag/1.1.1\nphp-fig/log 1.1.3 1.1.4 https://github.com/php-fig/log/\nreleases/tag/1.1.4\nphpseclib/phpseclib 2.0.31 3.0.9 https://github.com/phpseclib/\nphpseclib/releases/tag/3.0.9\nramsey/uuid 3.7.1 4.1.1 https://github.com/ramsey/uuid/\nreleases/tag/4.1.1\nseldaek/monolog 1.26.0 2.3.2 https://github.com/Seldaek/\nmonolog/releases/tag/2.3.2\nVersion 1.0- Page 7 of 33 Client Confidential\nThird-party Software Version Supported Version URL\nsilexphp/Pimple v3.2.2 v3.4.0 https://github.com/silexphp/\nPimple/releases/tag/v3.4.0\nsolariumphp/solarium 3.8.1 6.1.4 https://github.com/solariumphp/\nsolarium/releases/tag/6.1.4\nswiftmailer/swiftmailer v5.4.8 https://github.com/swiftmailer/\nswiftmailer/releases/tag/v6.2.7\nsymfony/cache 4.2.12 v5.3.4 https://github.com/symfony/\ncache/releases/tag/v5.3.4\nsymfony/console 2.5.4 v5.3.6 https://github.com/symfony/\nconsole/releases/tag/v5.3.6\nsymfony/contracts v1.0.2 v2.3.1 https://github.com/symfony/\ncontracts/releases/tag/v2.3.1\nsymfony/event-dispatcher v3.3.8 v5.3.4 https://github.com/symfony/\nevent-dispatcher/releases/tag/\nv5.3.4\nsymfony/http-foundation v3.4.36 v5.3.6 https://github.com/symfony/http-\nfoundation/releases/tag/\nv5.3.6\nsymfony/process v3.4.1 v5.3.4 https://github.com/symfony/\nprocess/releases/tag/v5.3.4\nsymfony/translation v4.4.4 v5.3.4 https://github.com/symfony/\ntranslation/releases/tag/v5.3.4\nsymfony/var-exporter v3.1.13 v5.3.4 https://github.com/symfony/\nvar-exporter/releases/tag/v5.3.4\nthephpleague/csv 9.1.4 9.7.1 https://github.com/\nthephpleague/csv/releases/tag/\n9.7.1\ntwilio/twilio-php 5.37.0 6.27.1 https://github.com/twilio/\ntwilio-php/releases/tag/6.27.1",
  "NCCGRPPHP-014": "NCCGRPPHP-014 Lack of Certificate Validation\nRisk Rating High Status Open\nDescription:\nAn attacker can intercept and modify network communication.\nThe application disabled certificate validation when using TLS for secure communication. TLS ensures traffic is securely\nencrypted so that an attacker cannot read or modify network data. However, the security of TLS relies on a certificate, which uniquely identifies one side of the communication. By verifying the certificate against a local certificate authority,\nthe client guarantees that communication has not been intercepted or modified.\nBecause the application does not correctly validate certificates, an attacker can substitute a malicious certificate in\norder to intercept and modify communication. Essentially, the lack of certificate validation defeats the protection\noffered by TLS. The following code disabled certificate validation:\nLine 113 $response_code = curl_exec($curl);\nLine 114 if (CURLE_OK !== curl_errno($curl)) {\nLine 115 Log::warning(\n'Failed to send SMS with SSL option. Will resend with no SSL option temporally. Error: ' .\ncurl_error($curl));\nLine 116\nLine 117 curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, false);\nLine 118 curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, false);\nLine 119 $response_code = curl_exec($curl);\nLine 120 }\nLine 121 curl_close($curl);\nThe code attempts to connect to a third-party site and if the error is received, it attempts to connect again without\ncertificate validation. If the third-party site presents an invalid certificate or self-sighed certificate the first attempt at\nconnection fails due to security concerns. However, the code then removes the security checks and connects to the\nthird-party site anyway.\nRecommendation:\nDo not disable certificate validation. Validation of X.509 certificates is essential to create secure SSL/TLS sessions not\nvulnerable to man-in-the-middle attacks.2\nThe certificate chain validation includes these steps:\nu The certificate is issued by its parent Certificate Authority or the root CA trusted by the system.\nu Each CA is allowed to issue certificates.\nu Each certificate in the chain is not expired.\n2CWE-295: Improper Certificate Validation: https://cwe.mitre.org/data/definitions/295.html",
  "NCCGRPPHP-018": "NCCGRPPHP-018 Poor Software Development Lifecycle\nRisk Rating High Status Open\nDescription:\nThe code base showed insufficient adherence to a software development lifecycle (SDL). Robust SDL implementation\nallows development of software of consistent quality, this was not evident from the code base.\nFollowing issues in the code indicated insufficient SDL practices:\nu High volume of Static Analysis issues. During the course of the assessment the code was processed by three PHP\nstatic analyzers (Sonar QUBE, PHPStan, Psalm). All three tools generated thousands of issues. This indicated the\nStatic Analysis was not a part of SDL process.\nu High number of technical debt issues recorded asTODO in the code (finding NCCGRPPHP-004 on page 13). The\nusage ofTODO does not match best SDL practices.\nu Uneven code quality. A number of files contained trivial errors (finding NCCGRPPHP-013 on page 18), (finding NCCGRPPHP-\n014 on the preceding page), (finding NCCGRPPHP-009 on page 25), (finding NCCGRPPHP-003 on page 12). This\nindicated insufficient code review practices and absence of coding standards.\nu Large number of hard-coded credentials, static keys and third-party URLs (finding NCCGRPPHP-002 on the next\npage), (finding NCCGRPPHP-006 on page 14), (finding NCCGRPPHP-011 on page 27). Hard-coded secrets do not\nmatch best SDL practices.\nu Absence of parity between production and test environments. A number of third-party connections were found to\nbe functional only in production environment. This practice reduces test coverage before release and forces testing\nto be performed in production.\nu Outdated and unsupported third-party components (finding NCCGRPPHP-001 on page 6).\nRecommendation:\nThe goal of the SDL is to minimize security-related vulnerabilities in the design, code, and documentation, and to detect\nand eliminate vulnerabilities as early as possible in the development lifecycle. These improvements reduce the number\nand severity of security vulnerabilities and improve the protection of users\u2019 privacy.\nIt is recommended to implement the following:\nu Integrate Static Analysis and Software Composition Analysis tools in the CI pipeline.\nu Migrate TODO technical issues to a issue database and perform triage of technical debt.\nu Enforce code review on all code by senior members of the development team.\nu Migrate secrets to the secure secret storage (this has been planned as indicated by the development team)\nu Migrate configuration system to common template to enforce parity between the environments. Use mock third-\nparty services to emulate their behavior in the test environment. Use a copy of the database with anonymized data\nin the test environment.\nu Enforce periodic updates of third-party components including PHP and MySQL.\nIt is important to note that the list of proposed changes is ambitious and the implementation may take a significant\nperiod of time. However, the improvement in SDL will directly affect the quality and security of the application as well\nas increase the productivity of developers.\nAffects:\nu Project in scope",
  "NCCGRPPHP-002": "NCCGRPPHP-002 Hard-Coded Trivial Credentials\nRisk Rating Medium Status Open\nDescription:\nThe codebase contained hard-coded credentials. This does not conform to security best practice, and is not indicative\nof a secure platform. In addition, the credentials were easily guessable.\nLine 14 environment:\nLine 15 DB_HOST: 127.0.0.1\nLine 16 MYSQL_ROOT_PASSWORD: ******\nLine 17 MYSQL_DATABASE: test\nLine 18 MYSQL_USER: user\nLine 19 MYSQL_PASSWORD: ******\nWhile applications may need to access credentials without user interaction, storing them in the code makes it difficult\nto change them - should the credentials be discovered, an attacker could gain access to the program.\nDiscovery of the credentials would also be easy; strings hard-coded into a binary are trivially extractable, using a variety\nof common tools, and so anyone with access to the binary file would be able to discover them with little effort.\nFurther, if multiple installations of the product share the same credentials, then an attacker with access to one installation could gain access to other instances. This can also lead in some circumstances to the possibility of the program\nbeing used as a vector to propagate worms.\nA full list of the instances of credentials in code has been provided in Affected Resources section.\nRecommendation:\nCredentials should not be hard-coded into the application. Rather, they should be stored separately, ideally in a\npassword vault, or in an encrypted file to which only one user has access.3, 4, 5\nAlternatively, credentials could be injected in the process environment. An example is shown below:\nLine 184 define('MQ_PASSWORD', getenv('MYSQL_ROOT_PASSWORD'));\nLine 185 define('MQ_ENQUEUE_PASSWORD', getenv('MYSQL_ROOT_PASSWORD'));\nAffects:\nFile Line\n/client-api-master/.circleci/config.yml 16\n3Hardcoded Credentials Example:http://nakedsecurity.sophos.com/2014/04/03/is-amazon-hacking-our-apps-or-doing-us-all-a-security-favour/\n4SANS Top 25 Software Flaws: Number 11, Hardcoded Credentials:http://software-security.sans.org/blog/2010/03/10/top-25-series-rank-11-har\ndcoded-credentials/\n5CWE-798: Use of Hard-Coded Credentials:http://cwe.mitre.org/data/definitions/798.html",
  "NCCGRPPHP-003": "NCCGRPPHP-003 Subscope Variable Overshadows Outer Scope Variable\nRisk Rating Medium Status Open\nDescription:\nSubscope variables declared with the same name as outer scope variables overshadow outer scope variables. This\nresults in code which is difficult to read and maintain. Such code can lead to bugs that are difficult to root cause.\nAn example of an overshadowed variable in the code is shown below:\nLine 7 protected $response = '';\n...\nLine 9 public function render($action = null)\nLine 10 {\n...\nLine 21 $response = self::extract($view_filename, $this->vars);\nPHP creates a new instance of the variable when it first encounters it in the scope. The code declared variable$resp\nonse was declared in the class scope on Line 7 and re-declared in the methodrender scope on line 21. As a result,\nassigning to variable$response on line 21 does not modify variable$response declared in line 7.6\nA full list of overshadowed variables found in the code is placed in theAffected Resources section below.\nRecommendation:\nDo not reuse identifier names in subscopes. Include the requirements in the process for code review. Refer to CMU\nSEI rules for more information7,.8\nAffects:\nFile Line Variable Overshadowed on Line\nclient-api-master/app/app_api_view.php 7 $response 21\n6PHP Variable Scope:https://www.php.net/manual/en/language.variables.scope.php\n7CMU SEI DCL01-C Do not reuse variable names in subscopes.:https://wiki.sei.cmu.edu/confluence/display/c/DCL01-C.+Do+not+reuse+variable+n\names+in+subscopes\n8CMU SEI DCL51-J Do not shadow or obsure identifiers.:https://wiki.sei.cmu.edu/confluence/display/java/DCL51-J.+Do+not+shadow+or+obscure+i\ndentifiers+in+subscopes",
  "NCCGRPPHP-004": "NCCGRPPHP-004 TODO Comments Indicate Incomplete Code\nRisk Rating Medium Status Open\nDescription:\nSource code contained a large number of comments marked TODO. This indicates incomplete code and could result\nin incorrect or insecure behaviour of the application.9\nAn example of a TODO comment is shown below:\nLine 32 //TODO: meta.notification\nLine 33 if($this->controller->isNeedForceLogout()===true){\nA full list of TODO comments found in the code is placed in theAffected Resources section below.\nRecommendation:\nReview TODO comments in the code. Create issues to track the code defects associated with TODO comments. Remove\nTODO comments for issues fixed or no longer applicable.\nAffects:\nFile Line\n/client-api-master/app/app_api_view.php 32\n9CWE-546: Suspicious Comment: http://cwe.mitre.org/data/definitions/546.html",
  "NCCGRPPHP-006": "NCCGRPPHP-006 Hard-coded Static Secrets\nRisk Rating Medium Status Open\nDescription:\nThe code base contained hard-coded static secrets. Static secrets by design do not change over time and are valid until\nexplicitly invalidated. As such static secrets represent continuous risk to the enterprise. Incorporating static secrets in\nthe source code elevates the risk to the enterprise.\nStatic secrets may include:\nu Cloud access keys\nu JWTs with secrets and no set expiration date\nu Private part of key pairs\nu Service access keys and IDs that do not require second factor authentication\nu Strong passwords\nStatic secrets are different from trivial hard-coded passwords described in finding NCCGRPPHP-002 on page 11. Static\nsecrets are designed to be resistant to brute-force attacks. An attack on static secret require gaining access to secret\nstorage. Unlike the dedicated secret storage the source code is not meant for storage of secrets. As a result, the risk\nto enterprise increases.\nBelow are examples of static secrets found in the code.\nu Configuration file contained cloud access keys (AWS). The cloud access keys were valid at the time of writing.\nThe cloud access keys were used withEnumberate IAM tool10 to brute-force account privileges in AWS. The tool\ncontained functionality to generate requests for the current version of AWS SDK. This allowed discovery of the\naccount privileges.\nLine 7 // AWS\nLine 8 define('AWS_ACCESS_KEY', 'AKIA************NUU7E');\nLine 9 define('AWS_SECRET_KEY', '6ZD*******************j');\n$ aws sts get-caller-identity\n{\n\"UserId\": \"AID***************\",\n\"Account\": \"30************\",\n\"Arn\": \"arn:aws:iam::30*************:user/************\"\n}\nThe list of static secrets found in the code is placed in theAffected Resources section.\nRecommendation:\nSecrets should not be hard-coded into the application. Rather, they should be stored separately, ideally in a password\nvault, or in an encrypted file to which only one user has access.11, 12, 13 Alternatively, secrets could be injected in the\nprocess environment. An example is shown below:\n10Enumerate IAM: https://github.com/andresriancho/enumerate-iam\n11Hardcoded Credentials Example:http://nakedsecurity.sophos.com/2014/04/03/is-amazon-hacking-our-apps-or-doing-us-all-a-security-favour/\n12SANS Top 25 Software Flaws: Number 11, Hardcoded Credentials:http://software-security.sans.org/blog/2010/03/10/top-25-series-rank-11-har\ndcoded-credentials/\n13CWE-798: Use of Hard-Coded Credentials:http://cwe.mitre.org/data/definitions/798.html\nLine 184 define('MQ_PASSWORD', getenv('MYSQL_ROOT_PASSWORD'));\nLine 185 define('MQ_ENQUEUE_PASSWORD', getenv('MYSQL_ROOT_PASSWORD'));\nAffects:\nFile Line Notes\n/client-api-master/app/config/credentials/jp_ci.php 8-9 AWS access key",
  "NCCGRPPHP-012": "NCCGRPPHP-012 Incorrect Creation of Static Object\nRisk Rating Medium Status Open\nDescription:\nA PHP function declared a static object with the intention to create one instance and return it to all callers. The function\nwas implemented incorrectly and returned a new instance of the object to every call.\nLine 143 /**\nLine 144 * @return UpdateService\nLine 145 */\nLine 146 private function getUpdateService()\nLine 147 {\nLine 148 static $service;\nLine 149\nLine 150 return $service ?: new UpdateService(Config::get('adapter'));\nLine 151 }\nThe following test case was created to show the problem:\n<?php\nclass Singleton\n{\nfunction __construct() {\nprint \"In Singleton constructor\\n\";\n}\n}\nclass TestSingleton\n{\npublic function BadCall()\n{\nstatic $service;\nreturn $service ?: new Singleton();\n}\npublic function GoodCall()\n{\nstatic $service;\nif (!isset($service)) {\n$service = new Singleton();\n}\nreturn $service;\n}\n}\n$a = new TestSingleton();\nprint(\"========Bad Calls================\\n\");\n$singl1 = $a->BadCall();\nvar_dump($singl1);\n$singl2 = $a->BadCall();\nvar_dump($singl2);\nprint(\"========Good Calls================\\n\");\n$singl3 = $a->GoodCall();\nvar_dump($singl3);\n$singl4 = $a->GoodCall();\nvar_dump($singl4);\n?>\nOutput of the test below shows thatBadCall() function creates new instance of the object every call.\n========Bad Calls================\nIn Singleton constructor\nobject(Singleton)#3 (0) {\n}\nIn Singleton constructor\nobject(Singleton)#4 (0) {\n}\n========Good Calls================\nIn Singleton constructor\nobject(Singleton)#5 (0) {\n}\nobject(Singleton)#5 (0) {\n}\nA list of incorrectly implemented static objects is placed in theAffected Resources section.\nRecommendation:\nReview list of incorrectly implemented static object. Consider if static objects are required in each case. If static objects\nare required, correct the code.\nAffects:\nFile Function Lines\n/client-api-master/src/Command/RebuildProductItemsIndexCommand.php getUpdateService() 143-151\n/client-api-master/src/Command/RebuildProductItemsIndexCommand.php getDeleteService() 165-174",
  "NCCGRPPHP-013": "NCCGRPPHP-013 All Exceptions Caught Without Processing\nRisk Rating Medium Status Open\nDescription:\nIn a number of places all exceptions were caught without re-throw. As a result, system exceptions were also caught\nand masked.\nPHP classException is a base class of all exceptions in PHP.14 The hierarchy of exceptions derived fromException\nincludes such exceptions as PharException and OverflowException that are thrown by the PHP run-time. These\nexceptions are not meant to be processed by the application as the application has no means of fixing the underlying\nproblem.15\nThe coding pattern when all exceptions are caught without reprocessing is called \u201cswallowing exceptions\u201d or \u201ceating\nerrors\u201d. The following code shows the pattern:\nLine 410 try {\n...<do many things>...\nLine 428 } catch (Exception $e) {\nLine 429 Log::warn(array(\nLine 430 'message' => 'sendEvent failed (MessageEvent::EVENT_ID_MAIL_SEND)',\nLine 431 ));\nLine 432 }\nList of \u201ceating errors\u201d pattern implementations is placed inAffected Resources section.\nRecommendation:\nAs a general rule, the application should not catch exceptions it cannot process. This rule is applicable to a large set of\nlanguages that implement exception hierarchy (C++, Java, C#, PHP, Python, etc.). It is recommended to all review the\ninstances of \u201ceating errors\u201d pattern in the code and implement specific catch clauses for application exceptions.\nAn example of correct exception handling is shown below. All applications level exceptions are caught and processed\nand all other exceptions are caught and re-thrown.\nLine 53 try {\n.. <do things>...\nLine 59 } catch (BankAccountNotFoundException $e) {\nLine 60 $db->rollback();\nLine 62 Log::info([\n...\nLine 68 } catch (ACLException $e) {\nLine 69 $db->rollback();\nLine 71 Log::info([\n...\nLine 122 } catch (Exception $e) {\nLine 123 $db->rollback();\nLine 124 throw $e;\n14PHP Class Exception: https://www.php.net/manual/en/language.exceptions.php\n15PHP Hierarchy of Exceptions: https://www.php.net/manual/en/class.error.php\nVersion 1.0- Page 18 of 33 Client Confidential\nLine 125 }\nAffects:\nFile Lines\n/client-api-master/app/models/bulk_distribution_service.php 400-405\n/client-api-master/app/models/bulk_distribution_service.php 410-432\n/client-api-master/app/models/bulk_distribution_service.php 437-458\n/client-api-master/app/models/config.php 141-145",
  "NCCGRPPHP-016": "NCCGRPPHP-016 Use of MD5 and SHA1\nRisk Rating Medium Status Open\nDescription:\nThe application made use of the MD5 ans SHA1 algorithms. These algorithms are now considered to be cryptographically weak, in that it is vulnerable to collision attacks. This means that it is possible for an attacker to create two\nmessages that have the same computed hash value.\nAdditionally MD5 is known to have a number of weaknesses, and is not allowed by the Microsoft SDL cryptographic\nstandards.16\nA full list of MD5 and SHA1 usage found in the code is included in theAffected Resources section.\nRecommendation:\nMD5 and SHA1 should be replaced with stronger algorithms, such as one of the SHA-2 family.\nAffects:\nFile Lines Notes\n/client-api-master/app/models/raw_iv_cert.php 32 SHA1\n16Analysis of MD5 Weaknesses: http://msdn.microsoft.com/en-us/magazine/ee321570.aspx",
  "NCCGRPPHP-017": "NCCGRPPHP-017 Inconsistent SQL Injection Prevention\nRisk Rating Medium Status Open\nDescription:\nBest practice recommendations for prevention of SQL injection were not followed in the PHP code base. As a result,\nthe application has potential SQL injection vulnerabilities.\nThe application used PHP Data Objects (PDO) and MySQL PDO driver to access the database. Following vulnerabilities\nrelated to SQL injection were found:\nu An attributePDO::ATTR_EMULATE_PREPARES was not set in the PDO. As a result, there was a possibility of prepared\nstatements being emulated. Emulation of prepared statements does not offer protection against SQL injection.17\nu The application used PDO::quote() for processing of untrusted data. PDO::quote is not recommended for defense against SQL injection.18 List of places where PDO::quote() was found is placed inAffected Resources section.\nRecommendation:\nPrepared statements or equivalent APIs that always correctly escape input to protect against SQL injection should be\nused.19\nAffects:\nFile Lines Notes\n/client-api-master/app/models/admin_bulk_contact_sent_push_likes_service.php 20-26 PDO::quote() used\n17PDO Attribute ATTR_EMULATE_PREPARES: https://www.php.net/manual/en/pdo.setattribute.php\n18PDO::quote() : https://www.php.net/manual/en/pdo.quote.php\n19PHP Security Cheat Sheet:https://www.owasp.org/index.php/PHP_Security_Cheat_Sheet",
  "NCCGRPPHP-005": "NCCGRPPHP-005 Nested Statements without Curly Braces\nRisk Rating Low Status Open\nDescription:\nA number of nested statements did not have curly braces. The omission of curly braces can be misleading, and may\nlead to the introduction of errors during maintenance.\nAn example of affected code is shown below:\nLine 32 foreach(Param::params() as $key => $value){\nLine 33 if(!is_array($value))\nLine 34 $_REQUEST[$key] = convert_en_to_em($value);\nLine 35 }\nA full list of locations where nested statements were found without curly braces is placed in theAffected Resources\nsection.\nRecommendation:\nAdd curly braces around nested statements. More information on code correctness rules related to this issue can be\nfound in the references.20\nAffects:\nFile Lines\n/client-api-master/app/app_controller.php 33-34\n20EXP52-J. Use braces for the body of an if, for, or while statement: https://wiki.sei.cmu.edu/confluence/display/java/EXP52-J.+Use+braces+for+the+b\nody+of+an+if%2C+for%2C+or+while+statement",
  "NCCGRPPHP-007": "NCCGRPPHP-007 PHP API Calls without Side Effects\nRisk Rating Low Status Open\nDescription:\nA number of PHP functions contained PHP API calls without side effects. Such statements do not produce results and are effectively meaningless. This may indicate misunderstanding by software developer of how PHP APIs work. As a\nresult, the program can behave incorrectly as it relies on the result of the API call that was not assigned. An example of a PHP statements without side effects is placed below:\nLine 68 trim($key);\nLine 69 trim($value); The call to APItrim() was never assigned. The original string value was not changed and a new value created by\ntrim() was lost. As a result, the expectation of the software developer that the string was trimmed was invalid.21\nThe list of PHP API calls without side effects is placed inAffected Resources section.\nRecommendation:\nA variable should be assigned the result of PHP API call. PHP API calls that do not have assignment (no side effects)\nshould be reviewed and removed.\nAffects:\nFile Line\nclient-api-master/app/commands/standalone_command.php 68\n21PHP trim() manual: https://www.php.net/manual/en/function.trim.php",
  "NCCGRPPHP-008": "NCCGRPPHP-008 Unreachable Code\nRisk Rating Low Status Open\nDescription:\nA number of PHP functions contained unreachable code. Such code would never execute in the program. However,\nthe presence of the code itself may introduce logical errors as developers incorrectly rely of the functionality provided\nby unreachable code. Following is the example of unreachable code in the program:\nLine 252 // DatabaseDepreatedQueryConfig::$deprecated_config\nLine 254 return $next_proxy($dbh, $sql, $params);\nLine 255\nLine 257 try {\nLine 258 list($ret, $message) = self::searchDeprecatedQuery($dbh, $sql);\nLine 259 if ($ret) {\nLine 261 Log::error([\nLine 262 'tag' => 'detect_deprecated_query',\nLine 263 'message' => $message,\nLine 264 ]);\nLine 265 }\nLine 266 } catch (Exception $e) {\nLine 267 Log::warning($e);\nLine 268 }\nThe return statement on Line 254 exits the scope of the function. As a result, code on Lines 257-268 would never\nexecute. However, a software developer that miss the return statement on Line 254 would incorrectly assume code\non Lines 257-268 executes and would rely on the results. The presence of unreachable or dead code in the program\nindicates insecure Software Development Lifecycle practices.[\u02c6footnoteName1]\nThe list of instances of unreachable code is placed inAffected Resources section.\n[\u02c6footnoteName1] :MITRE CWE-561 Dead Code:http://cwe.mitre.org/data/definitions/561.html\nRecommendation:\nReview all instances of unreachable code. Correct the flow to reach the code if the functionality is require. Remove the\nunreachable code if functionality is not required.\nAffects:\nFile Lines\n/client-api-master/app/config/database_sql_hook.php 257-268",
  "NCCGRPPHP-009": "NCCGRPPHP-009 Variable Assigned to Itself\nRisk Rating Low Status Open\nDescription:\nA number of PHP functions contained variables assigned to itself. There is not reason to re-assign a variable to itself.\nEither the statement is redundant and should be removed, or the re-assignment is a mistake and some other variable\nwas intended for the assignment instead.\nThe following code shows variables assigned to itself.\nLine 36 } elseif (strpos($url, '#') === 0) {\nLine 37 $url = $url;\nLine 38 } elseif (strpos($url, '?') === 0) {\nLine 39 $url = $url;\nLine 40 }\nThe list of instances of variables assigned to themselves is placed in theAffected Resources section.\nRecommendation:\nReview the instances of variables assigned to themselves and correct the code.\nu If the assignment was intended for some other variable fix the code.\nu If the assignment is a placeholder no operation, refactor the code to avoid assignment altogether.\nAffects:\nFile Line\nclient-api-master/app/config/router.php 37",
  "NCCGRPPHP-010": "NCCGRPPHP-010 Parameter Assigned Before Use\nRisk Rating Low Status Open\nDescription:\nA function parameter was assigned in the body of the function before use. This indicates potentially incorrect function logic. The following code illustrates the problem:\nLine 410 public static function getItemBrandGroup($options = null)\nLine 411 {\nLine 412 $db = DB::conn();\nLine 414 $rows = $db->rows('SELECT id, name FROM item_brand_groups ORDER BY id ASC');\nLine 415 if (!$rows) {\nLine 416 throw new NotFoundException();\nLine 417 }\nLine 419 $data = [];\nLine 420 foreach ($rows as $row) {\nLine 421 $item_brand_group = new ItemBrandGroup($row);\nLine 423 $rows_brands = $db->rows('SELECT item_brand_id FROM item_brands_item_brand_groups\nWHERE item_brand_group_id = ? ORDER BY id ASC', [$row['id']]);\nLine 424 if ($rows_brands) {\nLine 425 $ids = [];\nLine 426 foreach ($rows_brands as $rows_brand) {\nLine 427 $ids[] = $rows_brand['item_brand_id'];\nLine 428 }\nLine 429 if (count($ids) > 0) {\nLine 431 $options = ['ids' => join(',', $ids),];\nFunction getItemBrandGroup accepted parameter$options and did not use the value. The parameter was assigned\non Line 431. As a result the value of the parameter was lost. Potential explanations include:\nu The function is correct. It did not require parameter$options in the first place. The reuse of the name happened\naccidentally.\nu The function has a logical error. It should use parameter$options before assignment but never did.\nIt is impossible to evaluate the risk of this issue due to ambiguity of the code.\nRecommendation:\nDo not reuse parameter names in the body of the function. Treat all parameters as read-only values.",
  "NCCGRPPHP-011": "NCCGRPPHP-011 Hard-coded URLs and Cloud Bucket Names\nRisk Rating Low Status Open\nDescription:\nA number of PHP files contained hard-coded web service and AWS S3 bucket URLs. The implementation requires high manual effort to maintain and is prone to human errors. This is indicative of a poor Software Development Lifecycle\nprocess.\nThe application was deployed in a number of environments (Development, CI, Production). Corresponding PHP con-\nfiguration files are listed below.\nu Development deployment\n\u2013 /client-api-aster/app/config/credentials/development.php\nu CI deployment\n\u2013 /client-api-master/app/config/credentials/ci.php\nu Production deployment\n\u2013 /client-api-master/app/config/credentials/production.php\nu Locale Specific\n\u2013 /client-api-master/app/config/deferred_payment_delegator.php. The number and format of configuration options for environments were different from each other. This indicated\nthe deployments were also different from each other. As a result, functional tests executed in one environment (CI deployment) could not guarantee successful deployment in the other environment (Production). The list of hard-coded URLs, S3 bucket names and AWS ARNs is placed in theAffected Resources section.\nRecommendation:\nIn a mature SDL environment it is beneficial to have very similar deployments in integration test and production. This allows to quickly root cause issues without interrupting production application. New development can also be tested efficiently in the integration test environment before deployment in production.\nTo achieve very similar deployments, the configuration options for both environments should be generated from the same template. This ensures number of options and their format matches between environments. The configuration options should be stored in non-executable format to avoid side effects of PHP execution.\nIt is recommended to re-engineer the configuration system as follows:\nu Store all secrets, credentials and URLs in a secure database\nu Create single configuration file per environment. Use high-privilege script with access to secrets database to generate configuration file\nu Inject configuration to the process environment. This process will allow to separate life cycle of configuration from source code. The changes in URLs and S3 buckets\ncan be tracked in the configuration database.\nAffects:\nFile Line Notes\n/client-api-master/app/config/deferred_payment_delegator.php 6, 12, 21, 27 AWS S3 buckets\n/client-api-master/app/config/locale_specific_config/discount_sales_items_banner.p\nhp\n10-12, 18-20 URLs",
  "NCCGRPPHP-015": "NCCGRPPHP-015 HTTP Basic Authentication in Use\nRisk Rating Low Status Open\nDescription:\nThe application was accessible from the Internet and made use of HTTP basic authentication. In HTTP basic authentication, HTTP requests are sent by the client with the Authorization header, containing the username and password\nin a base64-encoded string. This is not a significant security concern by itself and this issue has been included in the report for informational and completeness purposes.\nThe following code used HTTP basic authentication for a cURL connection:\nLine 103 curl_setopt($curl, CURLOPT_USERPWD, sprintf(\"%s:%s\", $api[\"BASICAUTH_USER\"],\n$api[\"BASICAUTH_PASSWORD\"]));\nThe username and password in HTTP basic authentication can be trivially decoded by an attacker who is able to\nintercept network traffic. For this reason, a secure encrypted transport mechanism should be used in conjunction with HTTP basic authentication. As the application did not enforce validation of TLS certificate (details in the issue finding NCCGRPPHP-014 on page 9), a suitably positioned attacker able to intercept network traffic, would be able to derive the username and password.\nRecommendation:\nEnsure that all traffic between the user\u2019s browser and the web server should be enforced over an encrypted channel. This can be achieved by using HTTPS, which uses SSL/TLS to protect the data. Do not disable TLS certificate validation\nas it effectively removes the protection of an encrypted channel."
}