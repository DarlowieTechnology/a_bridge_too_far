phpmyadmin web application security assessment phpmyadmin may18,2016-version1.2 prepared for michalcihar gervasemarkham prepared by caramarie valentinleon(C)2016-nccgroup preparedbynccgroupsecurityservices,inc.forphpmyadmin.portionsofthisdocumentandthetemplatesusedinitsproduction arethepropertyofnccgroupandcannotbecopied(infullorinpart)withoutnccgroup'spermission. whileprecautionshavebeentakeninthepreparationofthisdocument,nccgroupthepublisher,andtheauthor(s)assumeno responsibilityforerrors,omissions,orfordamagesresultingfromtheuseoftheinformationcontainedherein. useofnccgroup's servicesdoesnotguaranteethesecurityofasystem,orthatcomputerintrusionswillnotoccur. 2 | phpmyadmin phpmyadmin/nccgroupconfidentialexecutive summary synopsis in the spring of 2016, mozilla engaged ncc group to perform a security assessment of phpmyadmin as part of mozilla's secure open source (sos) fund.1 phpmyadmin is a free and open source application that has been one of the defacto tools for managing and maintaining mysql databases for years. its wide adoptionmatchedwithitspotentialformisuse,warrants regularreviewfromasecurityperspective. this assessment was performed remotely by two ncc groupconsultants,caramarieandvalentinleon,over a period of two weeks from april 25th to may 6th. the assessment was conducted as a code-assisted penetrationtestofphpmyadminversion4.6.0(current release as of this writing). phpmyadmin provided access to key members of the development team and wascommittedtomakingthisprojectasuccess. scope nccgroup'sevaluationincluded: * main application portal: this portal is a mysql web administrationtool. theinterfacesupportsuserand databasemanagement,andaconsolefordirectsql statementandqueryexecution. * setup portal: providesaninterfaceforphpmyadmin application configuration, including security, import, export,andsqlquerysettings. * source code: while the focus of the assessment was not purely code review, ncc group reviewed sectionsdealingwithauthentication,inputvalidation, andcommandexecution. testenvironmentswerecreatedusingtheprecompiled phpmyadmin packages hosted onhttps://launchpad. net/~nijel/+archive/ubuntu/phpmyadmin. key findings the assessment uncovered several application flaws. someofthemorenotablewere: * alackoffilteringonusercsvoutputthatcouldallow anattackerto run arbitrary code on an administrator's computer. * improper cookie invalidation that could allow an attackertounsetinternalglobalvariables. * unauthenticated exposure of the cross-site request forgery (csrf) protection token that could allow an attackertoperformvariousattacksagainstphpmyad- minusers. * severaltraffic flows that expose sensitive data ormake use of plaintext http communications. this could allow an attacker to man-in-the-middle, perform csrf, or various other attacks against phpmyadmin users. limitations no major blockers were encountered during this as- sessment. testing environments had to be setup by ncc group consultants but this setup process was simple and automated, which helped the consultant team deliver value on the first day of testing. source code was available on the github project page and access to internal repositories was granted on the first dayoftesting. security recommendations in addition to the recommendations specified in each ofthevulnerabilitydetails,implementingthefollowing high-levelrecommendationswillallowphpmyadminto gainastrongersecuritystance. * update phpmyadmin to support modern security- related headers - http strict transport security and a stricter content security policy. toenableastricter contentsecuritypolicies(csp)(see vulnerability002), nccgrouprecommendsremovingalllegacyscripts insertedasinlinejavascriptandmovethemtoscript filesseparatefromthehtmlsource. * restrict all state changing actions to occur via http post.allowingstatechangingrequeststobesentvia getcanleaksensitivedata(see vulnerability001)and allow attackers to perform numerous attacks against phpmyadmin. thisviolatessecuritybestpractices. * provide users with hardening guides at install time andwarnusersaboutpotentialmisconfigurations,to reducetheriskofinsecureinstallations. * consider requiring installations to use tls by default. ifusershavenotalreadyacquiredcertificates,thenthe installation process should direct them through the processforacquisitionvialet'sencrypt. 2 * consider implementing an out-of-date software warn- ing toaidusersinmaintainingup-to-dateandsecure phpmyadmininstances. 1https://wiki.mozilla.org/moss/secure_open_source 2https://letsencrypt.org/ 3 | phpmyadmin phpmyadmin/nccgroupconfidentialproject dashboard t arget metadata name phpmyadmin t ype webapplication version 4.6.0 platform php engagement data t ype webapplicationsecurity assessment method code-assisted dates 2016-04-25to2016-05-06 consultants 2 level of effort 4person-weeks t argets build site https://launchpad.net/~nijel/+archive/ubuntu/phpmyadmin source https://github.com/phpmyadmin/phpmyadmin/tree/release_4_6_0/-commit 37b38431d167915675fc8ab512470528147e72de vulnerability breakdown criticalriskissues 0 highriskissues 0 mediumriskissues 3 lowriskissues 5 informationalissues 1 total issues 9 category breakdown authentication 1 dataexposure 3 datavalidation 4 sessionmanagement 1 key critical high medium low informational 4 | phpmyadmin phpmyadmin/nccgroupconfidentialt able of vulnerabilities foreachfinding,nccgroupusesacompositeriskscorethattakesintoaccounttheseverityoftherisk,application's exposureanduserpopulation,technicaldifficultyofexploitation,andotherfactors.foranexplanationofnccgroup's riskratingandvulnerabilitycategorization,see appendixaonpage15 . title id risk csvexportallowsarbitrarycommandexecutionincsvfile 006 medium login/logoutactionsvulnerabletocsrf 007 medium abilitytounsetarbitraryserverglobalvariables 009 medium sensitivevaluesvulnerabletosessionfixation 005 low sensitivedatainurlgetqueryparameters 001 low overlypermissivecontentsecuritypolicy 002 low filetraversalprotectionbypassonerrorreporting 004 low selfxssintable_row_action.php 008 low multiplehttpplaintextlinks 003 informational 5 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability details vulnerability csv export allows arbitrary command execution in csv file risk medium impact: medium,exploitability: high identifier ncc-1604_moss_phpmyadmin-006 category datavalidation location thecsvexportfunctionality 3 impact amalicioususercanchangeadatabasefieldsothatwhenanadministratorusestheexport functionalityandopenstheexportedcsvinaspreadsheeteditorsuchasexcel,codemay berunontheadministrator'scomputer. alternatively, amaliciousorcompromisedadmin- istrator can add or modify users with formulas in various fields to target other application administratorsandusers. description thecsvexportfunctionalitydoesnotproperlyescapeexportedcsvfieldvalues. thiscan lead to code execution on a user's computer. this is done by including a formula in the csv file that a spreadsheet editor similar to excel will evaluate - the formula can include commands to be run on the user's computer. for example, if a user changes a database name or column value to be=cmd|' /c calc'!a0 and the database is then exported in csvformatbyanotheruser, calc.exe willrunwhenthefileisevaluatedbyaspreadsheet editor. the victim user will be prompted with a warning, but since the user has downloaded the csvfromatrustedsource,theyarelikelytoallowthefunctionality. itshouldbenotedthat encapsulatingthevalueswithquotationmarks(")doesnotmitigatetheissue. reproduction steps 1. logintophpmyadminandinsert =cmd|' /c calc'!a0intoadatabasecolumnvalue. 2. exportthedatabaseincsvformat. 3. open the exported csv file that was exported in windows excel and click through the warnings. 4. observethecalculatorapplicationnowrunningonthecomputer. recommendation whenperformingacsvexport,foranycellthatstartswithan =,-,",@,or +,addaspaceto thebeginningandremoveanytabcharacters( 0x09)inthecell. alternatively,prependeach cell field with a single quote, so that their content will be read as text by the spreadsheet editor. 3https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/plugins/export/exportcsv.php 6 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability login/logout actions vulnerable to csrf risk medium impact: medium,exploitability: high identifier ncc-1604_moss_phpmyadmin-007 category datavalidation location thephpmyadminlogin 4 andlogout5 functionality impact an attacker could cause a user to logout of phpmyadmin. alternatively, a malicious user could cause a phpmyadmin administrator to authenticate to phpmyadmin using their ac- count. description cross-siterequestforgery(csrf)countermeasuresusedintheapplicationarenotvalidated fortheloginorlogoutphpmyadminfunctionalities. inacsrfattack,auserisforcedtoper- formstate-changingactionswithouttheirknowledge,whileauthenticatedtoanapplication. thecurrentcsrfcountermeasuresrequirethatallstate-changingrequestsincludea token. thelackofvalidationofthisvalueforboththeloginandlogoutfunctionalitiesleavesusers vulnerabletothistypeofattack. asaresult,anattackercouldcauseausertoauthenticate usinganotheraccountorendtheircurrentsession. reproduction steps 1. authenticatetophpmyadmin. 2. savethefollowingas csrf.html,openitinthesamebrowser.besuretomodifythe old_usr valuetotheauthenticateduser'snameandthedomaintoreflectyourenvironmentifnot usingalocaldeployment. <html> <body> <img src="http://localhost /phpmyadmin /index.php?db=&token=8 ec5d8124049db01413c49351d0acf44 &old_usr=[authenticated user]" /> </body> </html> 3. observetheuser'sendedsession. recommendation to ensure that state changing requests are from an authorized user, validate the included tokenvalue.inaddition,toensurethatsensitivedataisnotleakedviageturlqueryparam- etersperformallstatechangingrequestsaspostrequestsandsubmittingdataviarequest body(see findingncc-1604_moss_phpmyadmin-001onpage10 forfurtherdetails). 4https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/common.inc.php#l402-l403 5https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/common.inc.php#l407-l408 7 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability ability to unset arbitrary server global variables risk medium impact: undetermined,exploitability: medium identifier ncc-1604_moss_phpmyadmin-009 category datavalidation location thepma_removerequestvars()functionincleanup.lib.php 6 impact anattackercanforgerequeststhatwillremove(unset)specificglobalvariablesontheservice side. thiscanbeusedforatargeteddenialofservice(dos)andpotentiallyotherattacks. note: becauseofthelargeamountofglobalvariables,andtherelativelyshortnatureofthis assessment,nccgroupwasunabletofullydeterminetheimpactofthisvulnerability. description allphpfilesincludelibraries/common.inc.php,whichinturnincludeslibraries/cleanup.lib.php forsanitizinguserinputifthecross-siterequestforgerytokenismissing. thefunction pma _removerequestvars() iteratesovertheuserinputingetandpostvariables, aswellas cookies, and then removes the variables not whitelisted. this function however, appears tobecalling unset()on$global[$key]insteadof $_cookie[$key],effectivelyremoving globalvariables. an attacker can forge malicious urls and leverage the cleanup function to remove inter- nal variables. for instance, the$global['cfg'] array, containing the configuration of the application could be targeted. by supplying a parameter namedcfg in the request, the phpmyadminapplicationwillbecompletelyinaccessible(localdos). reproduction steps login to phpmyadmin then access the following url:/phpmyadmin/index.php?cfg=foo. noticehowthedisplayedpageiscompletelyblank. recommendation fixthe pma_removerequestvars()functiontocorrectlysanitizethe $_cookiearrayinstead ofthe $globalarray. 6https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/cleanup.lib.php#l28 8 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability sensitive values vulnerable to session fixation risk low impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-005 category sessionmanagement location thecross-siterequestforgery(csrf)protection tokenandthe phpmyadmincookie7 impact an attacker can perform various targeted attacks, such as csrf, against a victim user or administrator. description sessionfixationisatypeofsessionhijackingattackthatcanoccurwhenauserisnotassigned anewsessionidentifierpost-authentication. whenauserfirstvisitsthephpmyadminlogin page,theserversetsthe token csrfprotectionvalueand phpmyadmin cookie. whenthe userauthenticates,thesevaluesarenotreset. ifanattackerknowsthevalueoftheuser's to- kenbeforetheuserhasloggedin,theattackerwillbeabletoperformothertargetedattacks, suchascross-sitescripting(see findingncc-1604_moss_phpmyadmin-008onpage13 )or csrf,againsttheuser. currently all state-changing and other sensitive actions require additional cookies to suc- cessfully execute requests. consequently, the risk associated with thephpmyadmin cookie sessionfixationvulnerabilityisinformational-however,ifthisweretochangeinfuture,any actionrelyingonthiscookieforvalidationwouldbevulnerabletoattack. reproduction steps 1. proxybrowsertrafficusingaproxysimilartoburpproxy. 8 2. visitthephpmyadminloginpage, andmakenoteofthe phpmyadmin cookieandcsrf tokenvaluesincludedintheresponse. 3. authenticatetophpmyadmin. 4. observethelackofchangeforthe phpmyadmincookieandcsrf tokenvalues. recommendation when users authenticate, change rights levels, or identity, they should immediately be as- signedanewsessioncookie. thiscanbedonebyinvalidatingtheoldsessionidandissuing a new one. in addition, csrftokens should be reset with each new user session post- authentication. 7https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/session.inc.php 8https://portswigger.net/burp/download.html 9 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability sensitive data in url get query parameters risk low impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-001 category dataexposure location thefollowingparameters: token,sql_query,old_usr impact sensitive data may be intercepted by an attacker with the ability to read application traffic or logs. the attacker may then be able to perform chosen actions via the user's account, unbeknownsttotheuser. description severalparameterscontainingsensitivevaluesaretransmittedinurlgetqueryparameters. theseparametersincludethe token parameter,usedtomitigatecross-siterequestforgery attacks,sql_query,whichcontainssqlqueriesthathavebeenrunfromphpmyadmin,and old_usr,whichexposesthepreviouslyauthenticatedaccountusername. itshouldbenoted that while plaintext password values are masked for thesql_query parameter, password hashesarenot. sending sensitive information via url get query parameters unnecessarily exposes these valuesinlogs,caches,and refererheaderstothirdparties. get / http/1.1 host: codemirror .net ---redacted --- referer : http://localhost /phpmyadmin /setup/index.php? token=99b4e72f96146d5904c6f6d00539d711&page=form&formset =sql_queries connection : close refererheadertokenleaksareonlypossiblevialinksfromthechangelog( /phpmyadmin/ changelog.php)orphpmyadminsetupsite( /phpmyadmin/setup/index.php).neitherofthese pagesmakeuseofurl.php, 9 whichwouldeffectivelypreventthisleakage. whilecompromiseofthe token parametercanbedamagingforaphpmyadminuser,itis notlikelythatathirdpartywouldabusethevalue. itdoes,however,expandphpmyadmin's attacksurfaceandputsusersatriskintheeventofanattackonanyofthevariousthirdparty systemsornetworktraffic. reproduction steps 1. proxybrowsertrafficusingaproxysimilartoburpproxy. 2. authenticatetophpmyadmin. 3. observethe tokenasagetqueryparameterintheproxyhistory. recommendation submittheaboveparametersusingpostrequests,insteadofgetrequests.theparameters shouldbepassedinthepostrequestbodyandnotasurlqueryparameters. updatealllinksfromthechangelogandphpmyadminsetupsitetouseurl.php 10 toensure thatdataisnotunnecessarilyexposedtothird-partysites. donotenable $cfg['logincookierecall'] bydefault.11 thisisadefense-in-depthsolu- tiontoensurethatphpmyadminusernamesarenotleakedviathe old_usrparameterpost logout. 9https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 10https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 11https://docs.phpmyadmin.net/en/latest/config.html#cfg_logincookierecall 10 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability overly permissive content security policy risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-002 category authentication location thecontentsecuritypolicydefinedinlibraries/header.php 12 impact ifanapplicationendpointdisplaysanyuserinputfromtheurlinthecontentsofthepage, anattackercouldcraftalinkwithamaliciousjavascriptpayloadandcreateareflectedcross- sitescripting(xss)vulnerability. phpmyadminisvulnerable,asreflectedxsspayloadsare beingservedfrompagecontentsinsidetheorigin'sdomain(whichisallowedtoruninline javascript). description content security policy13 is a security feature that allows web sites to specify settings for modernbrowserstoenforceprotectionsonwebcontent. inthecaseofphpmyadmin,the followingcontent-security-policyheaderallowsinlineelementssuchas <script>and <style> tobeincludedinallpagesaslongastheyareloadedinthecontextofthesame origin. content -security -policy : default -src 'self' ;script -src 'self' 'unsafe-inline' 'unsafe-eval' ;;style-src 'self' 'unsafe-inline' ;img-src 'self' data: *. tile.openstreetmap .org; listing1: content-security-policyheader whiletheintentionofthepolicymayhavebeentorestrictloadingofscriptresourcestothose thatoriginatedfromthedomain,thispolicywillprovidenoprotectionagainstmosttypesof xssattacks,asmalicious <script>injectionscanstilloriginatefromthetrusteddomain. reproduction steps 1. proxybrowsertrafficusingaproxysimilartoburpproxy. 2. access/phpmyadmin/index.php. 3. observe the headers returned by the server, in particular, the ``content-security-policy'' header. recommendation tightenthecontentsecuritypolicyasmuchaspossible.disable `unsafe-eval'and`unsafe- inline'ifitsusecannotbejustified. whenaddingfunctionalitytothesiteinthefuture,keepthescopeforallowedscripts,styles, andjavascriptcallbacksassmallaspossible. rememberthatcontentsecuritypolicyisnota replacementforxssprotection. formoreinformationonthevariouscontentsecuritypolicy directives,seethemozilladevelopernetwork. 14 12https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/header.php#l541-l558 13https://www.nccgroup.trust/globalassets/our-research/us/whitepapers/csp_best_practices.pdf 14https://developer.mozilla.org/en-us/docs/security/csp/csp_policy_directives 11 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability file traversal protection bypass on error reporting risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-004 category dataexposure location theerrorreportingendpoint,availableaterror_report.php 15 impact itispossibletoconfirmthepresenceofsystemfilesontheremotehostaswellasobtaintheir linecount. description thepma_countlines()functionavailableonline229oferror_report.lib.php 16containslogic topreventmalicioususerinputfromopeningfilesoutsidethejavascriptdirectory. however, itispossibletobypasstheprotectionsandaccessfilesanywhereonthesystem. thefunctionattemptstotrackthefiledepthofthepathbysplittingthepathintopartsbe- tween the slash ``/'' delimiters. the function decrements the depth on parent ``/../'' parts, correctlyskipsdot``/./''parts(nodepthchange)andincrementsthedepthoneverythingelse. ifatanytimethedepthbecomesnegative(meaningthattheuserreachedadirectorybefore theintendedrootjavascriptdirectory),thefunctionreturns. thislogiccanbybypassedby sendingapathcontainingemptyparts``//'',whichwillincrementthetrackeddepthbutremain in the actual folder, allowing an attacker to then use the parent ``/../'' while still keeping a positivedepth. as thepma_countlines() function only reports the size of the target files and not their contents,thesignificanceofthisvulnerabilityisgreatlyreduced. furthermore,toexploitthis finding,the senderrorreports configurationsettingmustbesetto ask oralways. reproduction steps 1. configure phpmyadmin to report errors by setting the following line in /etc/phpmyad- min/config.inc.php: $cfg['servers '][$i]['senderrorreports '] = 'always '; 2. proxybrowsertrafficusingaproxysimilartoburpproxy. 3. triggeranerrorinthejavascriptfront-endbyinsertinganincorrectvariableorfunction nameinthejavascriptfiles. 4. interceptthepostrequestto /phpmyadmin/error_report.phpandmodifythefollowing section: exception [stack][12][ url]=http://localhost /phpmyadmin /js/get_scripts . js.php?scripts []=////////../../../../../../etc/passwd 5. observethereturnedlinecount. recommendation usephp's realpathfunction17 toverifythatthetargetjavascriptdirectoryisinthepath. ifthisisnotpossible,processemptyparts``//''ofthepaththesamewaythedot``/./''pathare processed: do not increment the depth. alternatively, consider rejectingaltogether paths containingtheparent``/../''directory. 15https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/error_report.php 16https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/error_report.lib.php#l229-l260 17https://secure.php.net/manual/en/function.realpath.php 12 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability self xss in table_row_action.php risk low impact: low,exploitability: low identifier ncc-1604_moss_phpmyadmin-008 category datavalidation location thepma_getqueryfromselected()functioninlibraries/mult_submits.lib.php 18 impact withknowledgeofthecsrf tokenitispossibletotriggeracross-sitescriptingvulnerability. description thepma_getqueryfromselected()functioninsidemult_submits.lib.php 19 takesuserinput andsanitizesitbeforedisplayingitbackinsidethepage. however,thefunctioncalls urlde- code()afterhtmlspecialchars(),20 allowingforspecialhtmlcharacterstobepassedas urlencodedvaluesanddisplayedbackasspecialcharactersinthepage. $full_query .= 'delete from ' . pma\libraries \util::backquote (htmlspecialchars ($table)) . ' where ' . urldecode(htmlspecialchars($sval)) . ';<br />'; thisvulnerablecodeisexecutedwhenbrowsingthedataofatable,thenselectingmultiple rowsandmarkingthemfordeletion. phpmyadminwillpreparethedeletesqlstatement itisabouttoexecuteanddisplayittotheuserforconfirmationbeforeexecutingit. anattackerwhoisabletogainaccesstothecsrf token value,suchasbyexploiting find- ingncc-1604_moss_phpmyadmin-005onpage9 ,willthenbeabletoexploitthisvulner- abilityandinjectjavascriptcodeintothevictim'ssession. reproduction steps 1. proxybrowsertrafficusingaproxysimilartoburpproxy. 2. navigatetothe``browse''sectionofatableinsideadatabase. 3. selectsomerowsthenclickon``delete''. 4. modifythepostrequestto /phpmyadmin/tbl_row_action.phpwiththefollowingbody: db=foo&table=bar&token=[token]&goto=sql.php&rows_to_delete %5b0%5d=%2560 bar%2560.%2560 a%2560%2 b%253d%2b3%25%33%31%25%33%63%25%34%39%25%34%64%25 %34%37%25%32%30%25%35%33%25%35%32%25%34%33%25%33%64%25%32%37%25%36%31%2 5%32%37%25%32%30%25%36%66%25%36%65%25%36%35%25%37%32%25%37%32%25%36%66% 25%37%32%25%33%64%25%32%37%25%36%31%25%36%63%25%36%35%25%37%32%25%37%34 %25%32%38%25%33%31%25%32%39%25%32%37%25%33%65& sql_query=select +*+from+% 60bar%60&clause _is_unique =1&ajax_request =true&ajax_page_request =true&su bmit_mult=delete &_nocache =1462283900030800007 a listing2: urlencodedpayloadof``<imgsrc='a'onerror='alert(1)'>'' 5. noticehowthejavascriptpayloadisexecutedbythebrowser. recommendation callhtmlspecialchars()aftercallinganytypeofdecodingonuserinput,inthiscase,swap thecallstohave: . ' where ' . htmlspecialchars(urldecode($sval)) 18https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l477 19https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l477 20https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/mult_submits.lib.php#l498 13 | phpmyadmin phpmyadmin/nccgroupconfidentialvulnerability multiple http plaintext links risk informational impact: medium,exploitability: low identifier ncc-1604_moss_phpmyadmin-003 category dataexposure location linkedpagesinthefollowing: * index.php21 * changelog.php22 * libraries/config/messages.inc.php23 * libraries/util.php24 impact requestsforthevariouscontentlinkedfromphpmyadminandtheassociatedsetupsitemay beinterceptedbyanattackerandmodifiedtoincludemaliciouscontent. alternatively, an attackercouldusethisvectortoperformansslstrippingattackagainsttheuser. description multiplepageslinkedfromthephpmyadminarehardcodedtomakeuseofplaintexthttp connections. an attacker in a privileged network position could arbitrarily modify the re- turnedcontentinordertoperformavarietyofattackssuchassslstripping,cross-sitescript- ing,phishing,etc. in addition, pages linked from the changelog (/phpmyadmin/changelog.php) and the ph- pmyadminsetupsite( /phpmyadmin/setup/index.php)donotmakeuseofurl.php. 25 asa result,linksfromeitherthechangelogorsetupsitewillleakthe tokentothirdpartiesviathe refererheader(see findingncc-1604_moss_phpmyadmin-001onpage10 ). reproduction steps 1. authenticatetophpmyadmin. 2. navigatetothe``officialhomepage''linkunderthe``phpmyadmin''sectionofhomepage. 3. observetheresultingrequestviaplaintexthttp. recommendation update all links to use https exclusively. it should be noted that each of the cited linked pagessupporthttpsversions,whichshouldmakesecuringlinksrelativelypainless. enforcingalllinkstoemployhttpswillsignificantlyreducetheunnecessaryriskplacedon users when switching between https and http connections, and will help mitigate data exposureandman-in-the-middleattacks. enablehttpstricttransportsecurity(hsts) 26 topreventusersfromaccidentallyvisitingthe siteoverunsecuredhttpandexposingthemselvestotheriskofansslstrippingattack. 27 notethatthehstsisignoredbybrowserswhensentoverhttp.itmustbesentoverhttps connections. 21https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/index.php 22https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/changelog.php 23https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/config/messages.inc.php 24https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/libraries/util.php 25https://github.com/phpmyadmin/phpmyadmin/blob/release_4_6_0/url.php 26https://www.owasp.org/index.php/http_strict_transport_security 27https://moxie.org/software/sslstrip/ 14 | phpmyadmin phpmyadmin/nccgroupconfidentialappendix a: vulnerability field definitions thefollowingsectionsdescribetheriskratingandcategoryassignedtoissuesnccgroupidentified. risk scale ncc group uses a composite risk score that takes into account the severity of the risk, application's exposure and userpopulation,technicaldifficultyofexploitation,andotherfactors. theriskratingisnccgroup'srecommended prioritizationforaddressingvulnerabilities. everyorganizationhasadifferentrisksensitivity,sotosomeextentthese recommendationsaremorerelativethanabsoluteguidelines. overall risk overallriskreflectsnccgroup'sestimationoftheriskthatavulnerabilityposestothetargetsystemorsystems. it takesintoaccounttheimpactofthevulnerability,thedifficultyofexploitation,andanyotherrelevantfactors. critical impliesanimmediate,easilyaccessiblethreatoftotalcompromise. high implies an immediate threat of system compromise, or an easily accessible threat of large-scale breach. medium a difficult to exploit threat of large-scale breach, or easy compromise of a small portion of the application. low impliesarelativelyminorthreattotheapplication. informational no immediate threat to the application. may provide suggestions for application improvement, functional issues with the application, or conditions that could later lead to an exploitable vulnerability. impact impactreflectstheeffectsthatsuccessfulexploitationuponthetargetsystemorsystems.ittakesintoaccountpotential lossesofconfidentiality,integrityandavailability,aswellaspotentialreputationallosses. high attackerscanreadormodifyalldatainasystem,executearbitrarycodeonthesystem,orescalate theirprivilegestosuperuserlevel. medium attackerscanreadormodifysomeunauthorizeddataonasystem,denyaccesstothatsystem,or gainsignificantinternaltechnicalinformation. low attackers can gain small amounts of unauthorized information or slightly degrade system performance. mayhaveanegativepublicperceptionofsecurity. exploitability exploitabilityreflectstheeasewithwhichattackersmayexploitavulnerability. ittakesintoaccountthelevelofaccess required, availabilityofexploitationinformation, requirementsrelatingtosocialengineering, raceconditions, brute forcing,etc,andotherimpedimentstoexploitation. high attackers can unilaterally exploit the vulnerability without special permissions or significant roadblocks. medium attackers would need to leverage a third party, gain non-public information, exploit a race condition, already have privileged access, or otherwise overcome moderate hurdles in order to exploitthevulnerability. low exploitationrequiresimplausiblesocialengineering,adifficultracecondition,guessingdifficultto guessdata,orisotherwiseunlikely. 15 | phpmyadmin phpmyadmin/nccgroupconfidentialcategory ncc group groups vulnerabilities based on the security area to which those vulnerabilities belong. this can help organizationsidentifygapsinsecuredevelopment,deployment,patching,etc. access controls relatedtoauthorizationofusers,andassessmentofrights. auditing and logging relatedtoauditingofactions,orloggingofproblems. authentication relatedtotheidentificationofusers. configuration relatedtosecurityconfigurationsofservers,devices,orsoftware. cryptography relatedtomathematicalprotectionsfordata. data exposure relatedtounintendedexposureofsensitiveinformation. data validation relatedtoimproperrelianceonthestructureorvaluesofdata. denial of service relatedtocausingsystemfailure. error reporting relatedtothereportingoferrorconditionsinasecurefashion. patching relatedtokeepingsoftwareuptodate. session management relatedtotheidentificationofauthenticatedusers. timing relatedtoraceconditions,locking,ororderofoperations. 16 | phpmyadmin phpmyadmin/nccgroupconfidential